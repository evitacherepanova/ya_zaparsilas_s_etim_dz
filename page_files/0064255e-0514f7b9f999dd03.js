"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[30],{12928:function(e,t,a){a.d(t,{AO:function(){return rt},Cl:function(){return ru},DW:function(){return aM},U7:function(){return ty},VK:function(){return aZ},aY:function(){return tK},kV:function(){return rc},nN:function(){return tX},vj:function(){return tE}});var r=a(86949),n=a(17740),s=a(78133),l=a(82485),o=a(76766),i=a(78252),u=a(97582),c=a(824),d=a(67294),m=a(90512),p=a(90893),h=a(96454),g=a(76607),f=a(60426),b=a(27030),v=a(57717),_=a(45710),y=a(38565),E=a(27484),P=a.n(E),x=a(29387),O=a.n(x),w=a(70178),k=a.n(w),j=a(19790),C=a(42520),N=a(90966),I=a(22946),z=a(64317),S=a(14546),D=a(66886),$=a(70600),Z=a.n($),M=a(10285),T=a.n(M);a(23945);var A=a(32628),F=a(29856),R=a(60657),H=a(60205),q=a(6794),L=a(24023),V=a(24276);a(24974),a(45617);var B=a(62644),G=a(43536),W=a(58647),Y=a(28282),U=a(80182),J=a(46500),Q=a(82097),X=a(66209),K=a(95811),ee=a(82910),et=a(40468),ea=a(90464),er=a(64846);a(47234),a(83669),a(13982),a(21381),a(13286),a(6877),a(99305);class en{constructor(){this.getCookie=l.ej,this.setCookie=l.d8}setLastSearch(e){let t=this.searchParamsToCookieValue(e);this.setCookie(this.cookieName,t,{expires:604800})}getLastSearch(){let e=this.getCookie(this.cookieName);return e?this.cookieValueToSearchParams(e):null}}function es(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[{id:1,age:null}];try{let a=JSON.parse(e);if(!Array.isArray(a)||0===a.length)return t;let r=[];for(let e=0;e<a.length;e++){let n=a[e];if(("number"!=typeof n||Number.isNaN(n))&&("object"!=typeof n||n))return t;r.push({id:e+1,age:n})}return r}catch(e){return t}}class el{constructor(e){this.add=e=>{this.state.list.push({id:this.getNewId(),age:e})},this.remove=e=>{let t=this.state.list.findIndex(t=>t.id===e);this.state.list.splice(t,1)},this.state=(0,r.sj)({list:e&&0!==e.length?e:[{id:1,age:null}]})}get list(){return this.state.list}getNewId(){return Math.max(0,...this.state.list.map(e=>e.id))+1}getCountsByType(){let e=0,t=0,a=0;return this.state.list.forEach(r=>{null===r.age?e++:null!==this.infantMaxAge&&r.age<=this.infantMaxAge?a++:null===this.childMaxAge||r.age<=this.childMaxAge?t++:e++}),{adult:e,child:t,infant:a}}splitAdults(){return this.state.list.reduce((e,t)=>null===t.age?Object.assign(Object.assign({},e),{adults:[...e.adults,t]}):null===this.childMaxAge||t.age<=this.childMaxAge?Object.assign(Object.assign({},e),{children:[...e.children,t]}):Object.assign(Object.assign({},e),{adults:[...e.adults,t]}),{adults:[],children:[]})}}class eo{constructor(e){let{searchParams:t,validator:a,searchParamsInitializer:n,submitter:s,lastSearch:l,renderEmptyFieldsOnSsr:o=!0}=e;this.init=()=>{if(this.state.initiated)return;let e=this.lastSearch.getLastSearch();e&&(this.state.searchParams=e),this.state.initiated=!0},this.state=(0,r.sj)({validationEnabled:!1,initiated:!!t,searchParams:(0,r.sj)(n.getInitialSearchParams(t)),submitted:!1}),this.validator=a,this.submitter=s,this.lastSearch=l,this.searchParamsInitializer=n,o||this.init()}get searchParams(){return this.state.searchParams}submit(){this.state.validationEnabled=!0,this.validator.validate(this.searchParams).isValid&&(this.state.submitted=!0,this.lastSearch.setLastSearch(this.searchParams),this.submitter.gotoOffers(this.searchParams))}get submitted(){return this.state.submitted}get validationResult(){return this.validator.validate(this.searchParams)}setSearchParams(e){this.state.initiated=!0,this.state.searchParams=this.searchParamsInitializer.getInitialSearchParams(e)}}function ei(e){return!!("string"==typeof e&&/^(0[1-9]|[12][0-9]|3[01])\.(0[1-9]|1[0-2])\.\d{4}$/.test(e))}function eu(e){return!!e&&"string"==typeof e}function ec(e){return ei(e)?e:void 0}class ed extends eo{constructor(){var e;super(...arguments),e=this,this.swapGeoPoints=function(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,{from:a,to:r}=e.searchParams.routes[t];e.searchParams.routes[t].from=r,e.searchParams.routes[t].to=a}}}function em(e){switch(null==e?void 0:e.type){case"aviaCity":return e.aviaId;case"trainStation":return e.rzdNumber;case"busStop":return e.busId;case"hotelDestination":return e.id;default:return}}class ep{constructor(e){this.logError=e,this.currentItems=(0,r.sj)({from:[{items:[],prevRequest:null,abortController:null,isError:!1,isDefaultItems:!1}],to:[{items:[],prevRequest:null,abortController:null,isError:!1,isDefaultItems:!1}]}),this.loadItems=e=>(0,u.mG)(this,[e],void 0,function(e){var t=this;let{fieldName:a,routeIndex:n=0,value:s,relatedField:l}=e;return function*(){var e,o,i,u;try{let c={fieldName:a,value:s,relatedField:"unknown"!==l.type?l:void 0},d=null===(e=t.currentItems[a][n])||void 0===e?void 0:e.prevRequest;if(!d||d.value!==c.value||em(d.relatedField)!==em(c.relatedField)){null===(u=null===(i=null===(o=t.currentItems[a][n])||void 0===o?void 0:o.abortController)||void 0===i?void 0:i.abort)||void 0===u||u.call(i);let e=new AbortController;t.currentItems[a][n]?(t.currentItems[a][n].abortController=(0,r.iH)(e),t.currentItems[a][n].prevRequest=c):t.currentItems[a][n]={items:[],abortController:(0,r.iH)(e),prevRequest:c,isError:!1,isDefaultItems:!1};let s=yield t.getSuggestItems({request:c,abortController:e});if(s.length>0)t.currentItems[a][n].items=s,t.currentItems[a][n].isDefaultItems=!1;else{let e=new AbortController;t.currentItems[a][n].abortController=(0,r.iH)(e),t.currentItems[a][n].items=yield t.getSuggestItems({request:{fieldName:a,value:"",relatedField:"unknown"!==l.type?l:void 0},abortController:e}),t.currentItems[a][n].isDefaultItems=!0}t.currentItems[a][n].isError=!1}}catch(e){if("name"in e&&("AbortError"===e.name||"CancelError"===e.name))return;if(t.currentItems[a][n].isError=!0,t.currentItems[a][n].items=[],t.logError)t.logError(e);else throw e}finally{t.currentItems[a][n].abortController=null}}()})}getItems(e){var t,a,r,n,s,l;let{fieldName:o,routeIndex:i=0}=e;return{items:null!==(a=null===(t=this.currentItems[o][i])||void 0===t?void 0:t.items)&&void 0!==a?a:[],isError:null!==(n=null===(r=this.currentItems[o][i])||void 0===r?void 0:r.isError)&&void 0!==n&&n,isDefaultItems:null!==(l=null===(s=this.currentItems[o][i])||void 0===s?void 0:s.isDefaultItems)&&void 0!==l&&l}}}(0,c.S1)().rules({routes:(0,c.pb)((0,c.S1)().rules({from:{requiredFrom:e=>!e||"unknown"===e.type,pointsAreEqual:(e,t)=>{let{data:{to:a}}=t;return"unknown"!==e.type&&"unknown"!==a.type&&e.aviaId===a.aviaId}},to:{requiredTo:e=>!e||"unknown"===e.type,pointsAreEqual:(e,t)=>{let{data:{from:a}}=t;return"unknown"!==a.type&&"unknown"!==e.type&&a.aviaId===e.aviaId}},date:{requiredDate:e=>!e,dateFormat:e=>{if(8!==e.length&&10!==e.length)return!0;let[t,a,r]=e.split(".");return(null==t?void 0:t.length)!==2||2!==a.length||(null==r?void 0:r.length)!==2&&(null==r?void 0:r.length)!==4||isNaN(Number.parseInt(t,10))||isNaN(Number.parseInt(a,10))||isNaN(Number.parseInt(r,10))},inPast:e=>{let[t,a,r]=e.split(".");return new Date(Number(r),Number(a)-1,Number(t),23,59,59).getTime()<new Date().getTime()}}}))}),P().extend(k()),P().extend(O());let eh=e=>{let[t,a,r]=e.split(".");return P().utc(`${r}-${a}-${t}`,"YYYY-MM-DD").tz("Europe/Moscow").valueOf()},eg={hotel:"hotels",avia:"avia",train:"train",bus:"bus",etrain:"etrain",go:"trip",tours:"tour",aeroexpress:"aeroexpress",multi:"all"},ef=e=>{let t={};return e&&(t.departure_date=eh(e)),t},eb=e=>{let t={};return e&&(t.return_date=eh(e)),t};function ev(e){return{block:"to"===e?"arrival":"departure"}}let e_=e=>{let{adult:t,child:a,infant:r}=e.getCountsByType();return{adult_count:t,child_count:a,infant_count:r,child_age:e.splitAdults().children.map(e=>e.age)}};function ey(e,t){let a=null;return(null==t?void 0:t.type)==="aviaCity"&&(a=t.aviaId),(null==t?void 0:t.type)==="trainStation"&&(a=t.rzdNumber),(null==t?void 0:t.type)==="busStop"&&(a=t.busId),(null==t?void 0:t.type)==="hotelDestination"&&(a=t.id),(null==t?void 0:t.type)==="unknown"&&(a=t.name),a?{["to"===e?"arrival_geo_id":"departure_geo_id"]:a}:{}}let eE={departure_city_error:"departure_city_error",arrival_city_error:"arrival_city_error",same_cities:"same_cities",wrong_date:"wrong_date"},eP=e=>{var t,a,r;let n=null===(a=null===(t=e.result)||void 0===t?void 0:t.routes)||void 0===a?void 0:a[0],s=[];return(null==n?void 0:n.from)&&(n.from.requiredFrom&&s.push(eE.departure_city_error),n.from.pointsAreEqual&&s.push(eE.same_cities)),(null==n?void 0:n.to)&&(null===(r=n.to)||void 0===r?void 0:r.requiredTo)&&s.push(eE.arrival_city_error),(null==n?void 0:n.date)&&s.push(eE.wrong_date),s};function ex(e){let{enabled:t,callback:a}=e;(0,d.useEffect)(()=>{if(t){let e=setTimeout(a,1e4);return()=>{clearTimeout(e)}}},[t])}let eO={xs:600};function ew(e){return e&&"object"!=typeof e?e:Object.assign(Object.assign({},eO),e)}let ek=(0,j.Cu)({500:300,600:400,700:400}),ej=(0,j.Cu)({500:200,600:200,700:300});function eC(e){return e?(0,C.kb)(e):{}}let eN=Object.assign(Object.assign({},Z()),{monthsShort:["янв","фев","мар","апр","мая","июня","июля","авг","сен","окт","ноя","дек"]});function eI(e,t){let a=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"ru";return P()(e).locale(a,"ru"===a?eN:void 0).format(t).replace(".","")}let ez="D MMM, dd",eS="D MMMM, dd",eD="D MMM",e$=e=>{let{dateFrom:t,dateTo:a,locale:r="ru",short:n=!1}=e;if(t&&a){let e=eI(t,ez,r),n=eI(a,ez,r),s=eI(a,eS,r),l=P()(t).date();return e===n?`${l}\u2009–\u2009${s}`:`${e}\u2009–\u2009${n}`}return t?n?eI(t,ez,r):eI(t,eS,r):""},eZ=e=>{let{dateFrom:t,dateTo:a,locale:r="ru"}=e,n=P()(t).date();if(P()(t).month()===P()(a).month()){let e=eI(a,eD,r);return`${n}\u00A0–\u00A0${e}`}return`${eI(t,eD,r)}\u00A0–\u00A0${eI(a,eD,r)}`},eM=e=>P()(e).format("DD.MM.YYYY");P().extend(T());let eT=e=>P()(e,"DD.MM.YYYY").toDate(),eA=new Date,eF=new Date(eA.getFullYear(),eA.getMonth(),eA.getDate()+1),eR=new Date(eA.getFullYear(),eA.getMonth(),eA.getDate()+2);eM(eA),eM(eF),eM(eR);let eH=(e,t)=>{let a;return function(){for(var r=arguments.length,n=Array(r),s=0;s<r;s++)n[s]=arguments[s];return new Promise(r=>{a&&clearTimeout(a),a=setTimeout(()=>r(e(...n)),t)})}},eq=(e,t)=>{let a=d.useRef();return d.useMemo(()=>function(){for(var r=arguments.length,n=Array(r),s=0;s<r;s++)n[s]=arguments[s];return new Promise(r=>{a.current&&clearTimeout(a.current),a.current=setTimeout(()=>{r(e(...n))},t)})},[e,t])};function eL(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:5e3,a=(0,q.r)(),r=eq(()=>{a.setOpen(!1)},t);return{state:a,handleAutoClose:()=>{e&&r()}}}function eV(e){return Array.isArray(e)?d.createElement(H.Rm,{sizeContrast:"small-small"},e.map(e=>d.createElement(R.cM,{key:e,label:e,labelColor:"primary"}))):e?d.createElement(H.Rm,{sizeContrast:"small-small"},d.createElement(R.cM,{label:e,labelColor:"primary"})):null}let eB=e=>{let{age:t,className:r,infantMaxAge:n,isDeleteDisabled:s=!1,autoCloseDeleteTooltip:l=!1,openDeleteTooltipOnClick:o=!1,deleteTooltipContent:i,deleteTooltipPosition:u,deleteTooltipSide:c,onTooltipOpen:m,onDeleteClick:g}=e,f=(0,y.Ei)(e=>a(45384)(`./${e}/index.json`)),v=eL(l);return d.createElement(F.bL,Object.assign({addonSize:"small",className:r},(0,p.ZP)("child_passenger")),d.createElement(H.Rm,{sizeContrast:"medium-plain"},d.createElement(R.cM,{label:f("title"),value:f("age",{found:0!==t,n:t}),emphasized:!0}),"number"==typeof n&&d.createElement(R.cM,{label:f(t>n?"with_place":"without_place")})),d.createElement(F.e9,null,d.createElement(z.u,{state:v.state,content:eV(i),position:u,side:c,openOnClick:o,closeOnTooltipClick:!0,stopMouseDownPropagation:!0,onOpen:()=>{null==m||m(),v.handleAutoClose()}},e=>{let{ref:t}=e;return d.createElement("div",{ref:t},d.createElement(h.zx,Object.assign({disabled:s,leftAddon:d.createElement(b.V,{icon:"cross_outline",shape:"noShape",size:100}),size:200,color:"secondary-neutral",onClick:g},(0,p.ZP)("child_passenger_delete_button"))))})))},eG=e=>{let{value:t,onPlusClick:r,onMinusClick:n,plusTooltipContent:s,minusTooltipContent:l,isMinusDisabled:o=!1,isPlusDisabled:i=!1,openPlusTooltipOnClick:u=!1,openMinusTooltipOnClick:c=!1,onTooltipOpen:f,autoClosePlusTooltip:_=!1,autoCloseMinusTooltip:E=!1}=e,P=(0,y.Ei)(e=>a(18337)(`./${e}/index.json`)),x=eL(E),O=eL(_);return d.createElement("div",{className:(0,m.W)(L.Z.wrapper,(0,g.j)("flex"))},d.createElement(z.u,{state:x.state,content:eV(l),position:"end",openOnClick:c,closeOnTooltipClick:!0,stopMouseDownPropagation:!0,onOpen:()=>{null==f||f("minus"),x.handleAutoClose()}},e=>{let{ref:t}=e;return d.createElement("div",{ref:t},d.createElement(h.zx,Object.assign({size:500,color:"secondary-neutral",disabled:o,onClick:n,type:"button","aria-label":P("removePassenger"),className:(0,v.o3)(200),leftAddon:d.createElement(b.V,{icon:"minus_outline",shape:"noShape",size:200})},(0,p.ZP)("minus_button"))))}),d.createElement("div",Object.assign({className:L.Z.count},(0,p.ZP)("count")),t),d.createElement(z.u,{state:O.state,content:eV(s),position:"end",openOnClick:u,closeOnTooltipClick:!0,stopMouseDownPropagation:!0,onOpen:()=>{null==f||f("plus"),O.handleAutoClose()}},e=>{let{ref:t}=e;return d.createElement("div",{ref:t},d.createElement(h.zx,Object.assign({size:500,color:"secondary-neutral",disabled:i,onClick:r,type:"button","aria-label":P("addPassenger"),className:(0,v.o3)(200),leftAddon:d.createElement(b.V,{icon:"plus_outline",shape:"noShape",size:200})},(0,p.ZP)("plus_button"))))}))},eW=e=>{let{value:t,onMinusClick:a,onPlusClick:r,title:n,subtitle:s,isMinusDisabled:l,isPlusDisabled:o,openPlusTooltipOnClick:i,openMinusTooltipOnClick:u,plusTooltipContent:c,minusTooltipContent:h,autoClosePlusTooltip:g,autoCloseMinusTooltip:f,className:b,onTooltipOpen:v}=e;return d.createElement(F.bL,Object.assign({addonSize:"small",contrast:"small",size:"medium",className:(0,m.Z)(V.Z.cell,b)},(0,p.ZP)("passengers_counter")),d.createElement(H.Rm,null,d.createElement(R.cM,Object.assign({isLabelAccent:!0,label:n,emphasized:!0},(0,p.ZP)("passengers_counter_title"))),d.createElement(R.cM,Object.assign({label:s},(0,p.ZP)("passengers_counter_subtitle")))),d.createElement(F.e9,null,d.createElement(eG,{value:t,isMinusDisabled:l,isPlusDisabled:o,openPlusTooltipOnClick:i,openMinusTooltipOnClick:u,plusTooltipContent:c,minusTooltipContent:h,autoClosePlusTooltip:g,autoCloseMinusTooltip:f,onMinusClick:a,onPlusClick:r,onTooltipOpen:v})))},eY=e=>{let{text:t,"data-ti":a}=e;return d.createElement(I.P,{className:(0,m.Z)(W.Z.text,(0,v.o3)(350)),size:"paragraph-medium","data-ti":a},t)},eU=(0,d.createContext)(400);function eJ(e){let{isDefaultItems:t,loadItems:a,point:r,setPoint:n,product:s,fieldName:l,label:o,hasError:i,errorMessage:u,onBlur:c,onFocus:m,inputRef:p,tabIndex:h,renderContent:g,items:f=[],selectOnClose:b,position:v,wrapperClassName:y,onErrorMessageClose:E,theme:P,searchId:x}=e,{userway:O}=(0,_.w5)(),w=null!=b?b:!t,k=(0,Y.Vt)({value:{xs:"modal",lg:"dropdown"}}),j=(0,q.r)(),[C,N]=d.useState(""),S=()=>{null==O||O(Object.assign({title:"search_form_close_city_suggest_click",product:eg[s]},ev(l)))},D=()=>{null==O||O(Object.assign({title:"search_form_clean_city_field_click",product:eg[s]},ev(l)))},$=e=>{var t,a;n(e.hiddenValue.geoPoint),null==O||O(Object.assign(Object.assign(Object.assign({title:"search_form_select_city_click",product:eg[s]},ev(l)),ey(l,null===(t=e.hiddenValue)||void 0===t?void 0:t.geoPoint)),{total_number_of_suggests:f.length,number_of_typed_symbols:("modal"===k?C:r.name).length,position_click:null===(a=e.hiddenValue)||void 0===a?void 0:a.index,hint_type_click:eQ(e),hint_types_available:f.map(eQ).filter((e,t,a)=>a.indexOf(e)===t)}))},Z=()=>{null==O||O(Object.assign(Object.assign({title:"search_form_city_field_click",product:eg[s]},ey(l,r)),x?{search_id:x}:{}))},M=()=>{null==O||O(Object.assign(Object.assign({title:"search_form_city_suggest_shown",product:eg[s]},ev(l)),{type:"special",total_number_of_suggests:f.length,element_state:"click"}))},T=(0,d.useContext)(eU),A=(0,d.useMemo)(()=>eH(e=>{a(e)},T),[a,T]);return d.useEffect(()=>{"dropdown"===k&&A(r.name),"modal"===k&&A(j.isOpen?C:"")},[k,j,C,r.name,A]),ex({enabled:!!u,callback:E}),d.createElement(z.X,{open:!!u,content:d.createElement(I.Dr,{color:"primary"},u),side:"modal"===k?"bottom":"top",maxWidth:"targetWidth",onClick:E,onClickOutside:E,position:"start"},e=>{let{ref:t}=e;return d.createElement(U.qY,Object.assign({},j,{wrapperClassName:y,position:v,tabIndex:h,onFocus:m,onBlur:c,ref:p,containerRef:t,containerStyle:null!=k?k:"modal",value:r.name,items:f,label:o,modalProps:{title:o,minHeight:"99%"},hasError:i,modalInputProps:{placeholder:r.name,value:C,onChange:e=>{N(e.currentTarget.value)}},dropdownProps:{maxHeight:450,minWidth:"300px",flip:!1},onChange:e=>{r.name!==e.currentTarget.value&&n({type:"unknown",name:e.currentTarget.value})},onValueSelect:$,renderContent:g,onClose:e=>{e.items&&e.items.length>0&&"dropdown"===e.style&&"select"!==e.reason&&""!==r.name&&"unknown"===r.type&&w&&n(e.items[0].hiddenValue.geoPoint),N(""),"modal"===e.style&&"closeButton"===e.reason&&S()},onMouseDown:Z,onClear:D,selectFirstItemOnEnterKeyPress:"modal"===k?""!==C:""!==r.name,onOpen:M,wrapperProps:eC(P)}))})}function eQ(e){var t;return(null===(t=e.hiddenValue)||void 0===t?void 0:t.isNearest)?"nearest":"popular"}class eX extends el{get infantMaxAge(){return null}get childMaxAge(){return 11}}class eK{getInitialSearchParams(e){var t,a;let r=e0();if(!e)return r;let n=this.convertOuterSearchParams(e);return Object.assign({routes:null!==(t=n.routes)&&void 0!==t?t:r.routes,passengers:null!==(a=n.passengers)&&void 0!==a?a:r.passengers},(null==e?void 0:e.searchId)?{searchId:e.searchId}:{})}convertOuterSearchParams(e){var t;let a=null==e?void 0:e.routes[0];return Object.assign({routes:[{from:a.from?{type:"busStop",name:a.from.value,busId:a.from.id,translitName:a.from.translitName,popular:a.from.popular}:{type:"unknown",name:""},to:a.to?{type:"busStop",name:a.to.value,busId:a.to.id,translitName:a.to.translitName,popular:a.to.popular}:{type:"unknown",name:""},date:null!==(t=a.date)&&void 0!==t?t:void 0}]},e.passengers?{passengers:new eX(e.passengers)}:{})}}function e0(){return{routes:[{from:{type:"unknown",name:""},to:{type:"unknown",name:""},date:void 0}],passengers:new eX}}function e1(e){return!!e&&"busStop"===e.type}function e2(e){return!!e&&void 0!==e.translitName}function e9(e){return!!e&&void 0!==e.popular}function e5(e){return!!e&&"object"==typeof e&&!!("busId"in e&&"name"in e&&"translitName"in e&&"popular"in e&&eu(e.busId)&&eu(e.name)&&eu(e.translitName))&&"boolean"==typeof e.popular}let e3=(e,t)=>{let{date:a}=e,r=e5(e.from)?e.from:t.from,n=e5(e.to)?e.to:t.to,s=e1(r)?`fbid::${r.busId};`:"",l=e1(n)?`tbid::${n.busId};`:"",o=e2(n)?`tt::${n.translitName};`:"",i=e2(r)?`ft::${r.translitName};`:"",u=e9(r)?`fp::${r.popular};`:"",c=e9(n)?`tp::${n.popular};`:"",d=eu(r.name)?`f::${r.name};`:"",m=eu(n.name)?`t::${n.name};`:"",p=ei(a)?`d::${a};`:"";return`${d}${s}${i}${m}${l}${o}${u}${c}${p}`},e6=(e,t)=>{let{routes:a,passengers:r}=e,n=e3(a[0],t.routes[0]),s=r.list.map(e=>{let{age:t}=e;return t}),l=r?`p::${JSON.stringify(s)};`:"";return`${l}${n}`},e4=(e,t)=>{let a=null==e?void 0:e.split(";"),r={p:"[null]",f:"",fbid:"",ft:"",t:"",tbid:"",tt:"",d:void 0,fp:"",tp:""};null==a||a.forEach(e=>{let[t,a]=e.split("::");t&&a&&(r[t]=a)});let n={type:"busStop",name:r.f,busId:r.fbid,translitName:r.ft,popular:"true"===r.fp},s={type:"busStop",name:r.t,busId:r.tbid,translitName:r.tt,popular:"true"===r.tp},l=e5(n)?n:t.routes[0].from,o=e5(s)?s:t.routes[0].to,i=es(r.p);return{routes:[{from:l,to:o,date:ec(r.d)}],passengers:new eX(i)}};class e7 extends en{constructor(){super(...arguments),this.initialSearchParams=e0(),this.busCookieName="sf_bus"}searchParamsToCookieValue(e){return e6(e,this.initialSearchParams)}cookieValueToSearchParams(e){return e4(e,this.initialSearchParams)}get cookieName(){return this.busCookieName}}class e8{constructor(e){this.params=e}gotoOffers(e){var t,a;if(this.busSearchId=(0,o.Z)(),null===(a=(t=this.params).onSubmit)||void 0===a?void 0:a.call(t,this.getOuterSearchParams(e)))return;let r=e.routes[0],n=this.params.busHost.replace("https://","").replace("http://",""),s=this.params.busRootPath?`${n}${this.params.busRootPath}`:n;this.openOffersPage((0,i.t6)(Object.assign(Object.assign({mainDomain:s},(null==r?void 0:r.date)?{searchId:this.searchId}:{}),this.getExternalSearchParams(e))))}openOffersPage(e){location.href=e}getOuterSearchParams(e){return{routes:e.routes.map(e=>({date:e.date,from:{id:e.from.busId,value:e.from.name,translitName:e.from.translitName,popular:e.from.popular},to:{id:e.to.busId,value:e.to.name,translitName:e.to.translitName,popular:e.to.popular}})),passengers:[...e.passengers.list]}}getExternalSearchParams(e){return{trips:e.routes.map(e=>{let{date:t,from:a,to:r}=e;if("busStop"!==a.type)throw Error("route.from is not correct bus stop");return{date:t,from:this.getBusCity(a),to:"busStop"===r.type?this.getBusCity(r):null}}),passengers:[...e.passengers.list]}}getBusCity(e){return{id:e.busId,value:e.name,translitName:e.translitName,popular:e.popular}}get searchId(){return this.busSearchId}}class te extends ed{constructor(e){var{suggest:t,calendarApiHost:a,holidaysApiHost:r}=e;super((0,u._T)(e,["suggest","calendarApiHost","holidaysApiHost"])),this.suggest=t,this.calendarApiHost=a,this.holidaysApiHost=r}}class tt extends ep{constructor(e,t){super(t),this.loader=e}getSuggestItems(e){return this.loader.getSuggestItems(e)}}let ta=(0,c.S1)().rules({routes:(0,c.pb)((0,c.S1)().rules({from:{requiredFrom:e=>!e||"unknown"===e.type,pointsAreEqual:(e,t)=>{let{data:{to:a}}=t;return"unknown"!==e.type&&"unknown"!==a.type&&e.busId===a.busId}},to:{pointsAreEqual:(e,t)=>{let{data:{from:a}}=t;return"unknown"!==a.type&&"unknown"!==e.type&&a.busId===e.busId}},date:{inPast:e=>{if(!e)return!1;let[t,a,r]=e.split(".");return new Date(Number(r),Number(a)-1,Number(t),23,59,59).getTime()<new Date().getTime()}}}))});class tr{validate(e){let t=ta.validate(e);return{result:t,isValid:null===t}}}let tn=()=>{let e=(0,y.Ei)(e=>a(48278)(`./${e}/index.json`));return d.createElement(d.Fragment,null,d.createElement("div",{className:(0,v.yl)(350)},d.createElement(I.P,{size:"paragraph-medium",hasExtraPaddingTop:!0},e("age_group_general_paragraph_1")),d.createElement(I.P,{size:"paragraph-medium"},e("age_group_general_paragraph_2"))),d.createElement("div",{className:(0,v.yl)(200)},d.createElement(F.bL,{addonSize:"small",size:"medium",contrast:"plain"},d.createElement(F.hZ,{icon:"person-child-stroller"}),d.createElement(R.cM,{label:e("age_group_title_type_1"),emphasized:!0})),d.createElement(I.P,{size:"paragraph-medium"},e("age_group_paragraph_1_type_1")),d.createElement(I.P,{size:"paragraph-medium"},e("age_group_paragraph_2_type_1")),d.createElement(I.P,{size:"paragraph-medium"},e("age_group_paragraph_3_type_1"))),d.createElement("div",{className:(0,v.yl)(200)},d.createElement(F.bL,{addonSize:"small",size:"medium",contrast:"plain"},d.createElement(F.hZ,{icon:"person-child"}),d.createElement(R.cM,{label:e("age_group_title_type_2"),emphasized:!0})),d.createElement(I.P,{size:"paragraph-medium",hasExtraPaddingTop:!0},e("age_group_paragraph_type_2"))))},ts=()=>{let{isOpen:e,setOpen:t}=(0,q.r)({initialIsOpen:!1}),r=(0,y.Ei)(e=>a(48278)(`./${e}/index.json`)),n=Array.from({length:12},(e,t)=>t),{userway:s}=(0,_.w5)();return d.createElement(d.Fragment,null,d.createElement(H.Rm,{sizeContrast:"medium-small",className:(0,m.Z)((0,v.yl)(200),(0,g.j)({xs:"none",lg:"flex"}))},d.createElement(R.cM,{emphasized:!0,isLabelAccent:!0,label:r("title-childrenModal")}),d.createElement(R.cM,{label:r("subtitle-childrenModal")})),d.createElement("div",{className:(0,v.yl)(200)},n.map(e=>d.createElement(B.h,{value:e,key:e},d.createElement(F.bL,{addonSize:"none",size:"medium",contrast:"small"},d.createElement(R.cM,{label:r("age",{found:0!==e,n:e}),emphasized:!0,expanded:!0}))))),d.createElement(h.zx,{className:(0,v.yl)(300),color:"secondary",size:400,firstLabel:r("age_informer_button"),fullWidth:!0,leftAddon:d.createElement(b.V,{icon:"info-circle"}),onClick:()=>{t(!e),null==s||s({title:"search_form_info_children_age_click",product:"bus"})}}),d.createElement(G.u_,{isOpen:e,setOpen:t,title:r("why_choose_age"),hasBackButton:!1,size:"small"},d.createElement(tn,null)))},tl=e=>{let{maxPassengers:t,passengers:r,onClose:s}=e,[l,o]=d.useState(!1),i=(0,n.R)(r),{adults:u,children:c}=i.splitAdults(),{userway:f}=(0,_.w5)(),E=u.length,P=(0,y.Ei)(e=>a(48278)(`./${e}/index.json`)),x=1===u.length,O=t<=i.list.length,w=e=>{r.remove(e)},k=()=>{o(!l),null==f||f({title:"search_form_add_child_click",product:"bus"})};return d.createElement(d.Fragment,null,d.createElement(eW,{isMinusDisabled:x,isPlusDisabled:O,value:u.length,openPlusTooltipOnClick:O,plusTooltipContent:P("max_passengers",{count:t}),autoClosePlusTooltip:!0,autoCloseMinusTooltip:!0,title:P("adults"),subtitle:P("initial_adult_age"),className:(0,v.E9)(100),onMinusClick:()=>{null==f||f({title:"search_form_change_adults_click",product:"bus",element_name:"minus",adult_count:E-1}),1!==E&&r.remove(u[u.length-1].id)},onPlusClick:()=>{null==f||f({title:"search_form_change_adults_click",product:"bus",element_name:"plus",adult_count:E+1}),r.add(null)},onTooltipOpen:e=>{"plus"===e?null==f||f({title:"search_form_max_passengers_tooltip_shown",type:"special",product:"bus"}):"minus"===e&&(null==f||f({title:"search_form_children_tooltip_shown",type:"special",product:"bus"}))}}),c.map((e,t)=>{let{id:a,age:r}=e;return d.createElement(eB,{key:a,age:r,className:0!==t?(0,v.E9)(200):void 0,onDeleteClick:()=>{w(a),null==f||f({title:"search_form_remove_child_click",product:"bus"})}})}),d.createElement(A.z,{containerStyle:{xs:"modal",lg:"dropdown"},size:700,onChange:e=>{r.add(e),o(!1)},isOpen:l,renderContent:()=>d.createElement(ts,null),setOpen:o,modalProps:{title:P("title-childrenModal"),subtitle:P("subtitle-childrenModal"),closeOnClickOutside:!0,closeOnCloseButtonClick:!0},dropdownProps:{closeOnClickOutside:!0,stopMouseDownPropagation:!0,useAvailableScreenHeight:!0,minHeight:"300px",minWidth:"330px"}},e=>{let{ref:t}=e;return d.createElement(h.zx,Object.assign({ref:t,className:(0,m.Z)((0,v.E9)(200),(0,v.yl)({xs:0,lg:300})),disabled:O,leftAddon:d.createElement(b.V,{icon:"person-child"}),size:400,color:"secondary",firstLabel:P("add_child_button"),onClick:k,fullWidth:!0},(0,p.ZP)("add_child_button")))}),d.createElement(h.zx,{className:(0,m.Z)((0,v.E9)(350),(0,g.j)({lg:"none"})),size:500,fullWidth:!0,color:"primary",type:"button",firstLabel:P("ready"),onClick:s}))},to=e=>{let{searchParams:t,initiated:r,theme:s}=e,[l,o]=d.useState(!1),{userway:i}=(0,_.w5)(),u=(0,y.Ei)(e=>a(48278)(`./${e}/index.json`)),c=(0,n.R)(t),m=u("input_value",{count:c.passengers.list.length}),p=()=>{null==i||i({title:"search_form_change_passengers_click",product:"bus",passenger_count:t.passengers.list.length})},h=()=>{o(!l)},g=()=>{null==i||i(Object.assign({title:"search_form_close_passengers_click",product:"bus",passenger_count:t.passengers.list.length,element_state:"other"},e_(t.passengers)))},f=()=>{null==i||i(Object.assign({title:"search_form_close_passengers_click",product:"bus",passenger_count:c.passengers.list.length,element_state:"button"},e_(t.passengers)))};return d.createElement(A.z,{size:700,containerStyle:{xs:"modal",lg:"dropdown"},isOpen:l,renderContent:()=>d.createElement(tl,{maxPassengers:10,passengers:t.passengers,onClose:()=>{o(!1),f()}}),setOpen:o,modalProps:{title:u("mobile_title"),closeOnClickOutside:!0,closeOnCloseButtonClick:!0,onClickOutside:g,minHeight:"auto",stopMouseDownPropagation:!1},dropdownProps:{closeOnClickOutside:!0,onClickOutside:g,position:"end",minWidth:"370px"}},e=>{let{ref:t}=e;return d.createElement(N.I,{wrapperClassName:`${Q.Z.passengers} ${(0,v.yl)({xs:300,lg:0})}`,containerRef:t,position:{lg:"middle-horizontal",xl:"middle-horizontal"},"data-ti":"passengers_input",type:"text",label:u("input_label"),value:r?m:"",onMouseDown:p,onFocus:h,readOnly:!0,clearButtonType:"hidden",wrapperProps:eC(s)})})},ti=(0,d.memo)(e=>{let{fieldName:t,suggest:r}=e,s=(0,y.Ei)(e=>a(48963)(`./${e}/index.json`)),{items:l,isError:o}=(0,n.R)(r).getItems({fieldName:t});return o&&0===l.length?d.createElement(U.vQ,null,s("error")):l.map(e=>{var t,a,r;let n=[null===(t=e.country)||void 0===t?void 0:t.name,null===(a=e.region)||void 0===a?void 0:a.name,null===(r=e.district)||void 0===r?void 0:r.name].filter(Boolean).join(", ");return d.createElement(U.uj,{value:e.geoPoint.busId,key:e.geoPoint.busId},d.createElement(H.Rm,null,d.createElement(R.cM,{label:e.geoPoint.name,isLabelAccent:!0,emphasized:!0}),n&&d.createElement(R.cM,{label:n})))})});function tu(e){let{fieldName:t,searchParams:a,suggest:r,routeIndex:s=0}=e,l=(0,u._T)(e,["fieldName","searchParams","suggest","routeIndex"]),o=(0,n.R)(r),{items:i,isDefaultItems:c}=o.getItems({fieldName:t}),m=(0,n.R)(a,{sync:!0}).routes[s],p=m["from"===t?"to":"from"],h=i.map((e,t)=>({value:e.geoPoint.busId,hiddenValue:Object.assign(Object.assign({},e),{index:t})})),g=(0,d.useCallback)(e=>{o.loadItems({value:e,fieldName:t,relatedField:p,routeIndex:s})},[t,p,s,o]);return d.createElement(eJ,Object.assign({},l,{fieldName:t,point:m[t],setPoint:e=>{a.routes[s][t]=e},isDefaultItems:c,items:h,loadItems:g,renderContent:()=>d.createElement(ti,{suggest:r,fieldName:t}),searchId:null==a?void 0:a.searchId}))}let tc={find_tickets:"Найти билеты",today:"Сегодня",tomorrow:"Завтра",from:"Откуда",to:"Куда",when:"Когда",who:"Кто едет",requiredFrom:"Выберите место отправления",pointsAreEqual:"Места отправления и\xa0назначения не\xa0должны совпадать",inPast:"Выберите не\xa0прошедшую дату",swapGeoPoints:"Поменять местами отправление и прибытие"},td=!1,tm=["from","to","date"],tp={busId:"1447874",name:"Москва",type:"busStop",translitName:"Moskva",popular:!0},th={busId:"1447624",name:"Санкт-Петербург",type:"busStop",translitName:"Sankt-Peterburg",popular:!0},tg=[tp,th],tf=[th,tp],tb=new Date,tv=new Date(tb.getFullYear(),tb.getMonth(),tb.getDate()+1),t_=[{name:(0,J.ZP)(tc,"today"),date:eM(tb)},{name:(0,J.ZP)(tc,"tomorrow"),date:eM(tv)}],ty=e=>{var t,r,s,l,o,i,u;let{model:c,inputsTheme:m,hideHints:E=!1,size:P}=e,x=(0,S.H)({min:"lg"}),O=(0,y.Ei)(e=>a(2118)(`./${e}/index.json`)),w=(0,n.R)(c),k=(0,D.n)({dateFrom:w.searchParams.routes[0].date?eT(w.searchParams.routes[0].date):null,onChangeDates:(0,d.useCallback)(e=>{c.searchParams.routes[0].date=e.dateFrom?eM(e.dateFrom):void 0},[c]),isOneway:!0}),j={from:w.searchParams.routes[0].from.busId,to:w.searchParams.routes[0].to.busId},{validationEnabled:C}=w.state,{result:$}=C?w.validationResult:{result:null},{0:Z,1:M}=(0,d.useState)(null),T=null===(t=null==$?void 0:$.routes)||void 0===t?void 0:t[0],A=(()=>{var e,t;if(!T)return null;if(Z)for(let e=0;e<tm.length;e++){let t=tm[e];if(T[t]&&Z===t)return t}if((null===(e=T.from)||void 0===e?void 0:e.errors[0].type)==="pointsAreEqual"&&(null===(t=T.to)||void 0===t?void 0:t.errors[0].type)==="pointsAreEqual")return"to";for(let e=0;e<tm.length;e++){let t=tm[e];if(T[t])return t}return null})(),{userway:F}=(0,_.w5)(),R=()=>{c.swapGeoPoints(),null==F||F({title:"search_form_change_destination_click",product:"bus"})},{0:H,1:q}=(0,d.useState)({from:!1,to:!1,date:!1}),L=()=>{var e;(null===(e=c.validationResult)||void 0===e?void 0:e.isValid)||null==F||F({title:"search_form_error_shown",type:"special",product:"bus",validation_errors:eP(w.validationResult)}),c.submit(),M(null),q({from:!1,to:!1,date:!1});let{from:t,to:a,date:r}=c.searchParams.routes[0],n="busStop"===t.type?{departure_geo_id:t.busId}:{},s="busStop"===a.type?{arrival_geo_id:a.busId}:{},{searchId:l}=c.submitter;null==F||F(Object.assign(Object.assign(Object.assign(Object.assign(Object.assign({title:"search_form_search_click",product:"bus",search_id:l},n),s),ef(r)),{route_type:"oneway",passenger_count:c.searchParams.passengers.list.length}),e_(c.searchParams.passengers)))},V="date"===A&&!H.date,B=(0,d.useCallback)(()=>{q(e=>Object.assign(Object.assign({},e),{date:!0}))},[]);ex({enabled:V,callback:B}),(0,d.useEffect)(()=>{if(c.init(),!td){let{from:e,to:t,date:a}=c.searchParams.routes[0],r="busStop"===e.type?{departure_geo_id:e.busId}:{},n="busStop"===t.type?{arrival_geo_id:t.busId}:{};null==F||F(Object.assign(Object.assign(Object.assign(Object.assign(Object.assign({title:"search_form_first_shown",product:"bus"},r),n),ef(a)),{route_type:"oneway",passenger_count:c.searchParams.passengers.list.length}),e_(c.searchParams.passengers))),td=!0}},[c,F]);let G=ew(P);return d.createElement(f.cw,Object.assign({size:G,layout:{xs:"vertical",xl:"horizontal"}},(0,p.ZP)("bus-search-form")),d.createElement("div",{className:Q.Z.searchForm},d.createElement("div",{className:`${Q.Z.firstSubGroup} ${(0,f.dm)({lg:["bottom"],xl:["none"]})}`},d.createElement("div",Object.assign({className:Q.Z.departure},(0,p.ZP)("departure-suggest")),d.createElement(tu,{product:"bus",position:{xs:"top",lg:"left"},label:O("from"),fieldName:"from",searchParams:c.searchParams,suggest:c.suggest,hasError:!!(null==T?void 0:T.from),errorMessage:"from"!==A||H.from?void 0:O(null===(l=null===(s=null===(r=null==T?void 0:T.from)||void 0===r?void 0:r.errors)||void 0===s?void 0:s[0])||void 0===l?void 0:l.type),onFocus:()=>{C&&M("from")},tabIndex:0,onErrorMessageClose:()=>{q(e=>Object.assign(Object.assign({},e),{from:!0}))},theme:m}),!E&&d.createElement("div",{className:`${(0,g.j)({xs:"none",xl:"inline-flex"})} ${(0,v.E9)(200)} ${(0,v.SG)(100)}`},tg.map(e=>d.createElement(h.zx,Object.assign({color:"secondary-neutral",size:ej(G),key:e.name,onClick:()=>{c.searchParams.routes[0].from=e,null==F||F({title:"search_form_city_hint_click",product:"bus",geo_id:e.busId,block:"departure"})}},(0,p.ZP)("fromHint")),e.name)))),d.createElement(h.zx,Object.assign({"aria-label":O("swapGeoPoints"),className:`${Q.Z.switcher} ${(0,g.j)({xs:"inline-flex",lg:"none"})}`,accent:"default",color:"outline-form",leftAddon:d.createElement(b.V,{icon:"arrow-2-up-down_outline"}),size:ek(G),onClick:R,tabIndex:0},(0,p.ZP)("swapButton"),eC(m))),d.createElement(h.zx,Object.assign({"aria-label":O("swapGeoPoints"),position:{lg:"middle-horizontal"},className:`${Q.Z.switcher} ${(0,g.j)({xs:"none",lg:"inline-flex"})}`,accent:"default",color:"outline-form",leftAddon:d.createElement(b.V,{icon:"arrow-2-left-right_outline"}),size:G,onClick:R,tabIndex:0},(0,p.ZP)("swapButton"),eC(m))),d.createElement("div",Object.assign({className:Q.Z.arrival},(0,p.ZP)("arrival-suggest")),d.createElement(tu,{product:"bus",position:{xs:"middle-vertical",lg:"right",xl:"middle-horizontal"},label:O("to"),fieldName:"to",searchParams:c.searchParams,suggest:c.suggest,hasError:!!(null==T?void 0:T.to),errorMessage:"to"!==A||H.to?void 0:O(null===(u=null===(i=null===(o=null==T?void 0:T.to)||void 0===o?void 0:o.errors)||void 0===i?void 0:i[0])||void 0===u?void 0:u.type),onFocus:()=>{C&&M("to")},tabIndex:0,onErrorMessageClose:()=>{q(e=>Object.assign(Object.assign({},e),{to:!0}))},theme:m}),!E&&d.createElement("div",{className:`${(0,g.j)({xs:"none",xl:"inline-flex"})} ${(0,v.E9)(200)} ${(0,v.SG)(100)}`},tf.map(e=>d.createElement(h.zx,Object.assign({color:"secondary-neutral",size:ej(G),key:e.name,onClick:()=>{c.searchParams.routes[0].to=e,null==F||F({title:"search_form_city_hint_click",product:"bus",geo_id:e.busId,block:"arrival"})}},(0,p.ZP)("toHint")),e.name))))),d.createElement(D.S,Object.assign({},k,{withAnimation:!1,product:"bus",block:"search_form",apiHost:w.calendarApiHost,calendarHost:w.holidaysApiHost,isDesktop:null==x||x,cityIds:j,popupContentClassName:Q.Z.calendarPopup,passengers:w.searchParams.passengers.getCountsByType(),target:e=>{var t,a,r,n,s,l;let{fromRef:o}=e;return d.createElement("div",{className:`${Q.Z.secondSubGroup}`},d.createElement("div",{className:`${Q.Z.targetDate}`},d.createElement(z.X,{open:V,content:(null===(r=null===(a=null===(t=null==T?void 0:T.date)||void 0===t?void 0:t.errors)||void 0===a?void 0:a[0])||void 0===r?void 0:r.type)?d.createElement(I.Dr,{color:"primary"},O(null===(l=null===(s=null===(n=null==T?void 0:T.date)||void 0===n?void 0:n.errors)||void 0===s?void 0:s[0])||void 0===l?void 0:l.type)):null,side:"top",onClick:B,onClickOutside:B,position:"start",targetRef:o},e=>{var t,a,r;let{ref:n}=e;return d.createElement(N.I,{wrapperClassName:`${Q.Z.date} ${(0,f.dm)({xs:["bottom"],lg:["none"]})}`,wrapperProps:eC(m),position:{xs:"bottom",lg:"left",xl:"middle-horizontal"},containerRef:n,"data-ti":"trip-dates",type:"text",label:O("when"),value:e$({dateFrom:k.chosenDates.dateFrom,dateTo:k.chosenDates.dateTo}),onChange:()=>{},hasError:C&&!!(null===(a=null===(t=null==$?void 0:$.routes)||void 0===t?void 0:t[0])||void 0===a?void 0:a.date),onClear:()=>{k.clearDate()},onFocus:()=>{C&&M("date")},tabIndex:0,readOnly:!0,clearButtonType:{xs:"hidden",lg:"from"===k.chosenDates.focusedInput&&(null===(r=k.chosenDates)||void 0===r?void 0:r.dateFrom)?"force":"hidden"}})}),!E&&d.createElement("div",{className:`${(0,g.j)({xs:"none",xl:"inline-flex"})} ${(0,v.E9)(200)} ${(0,v.SG)(100)}`},t_.map(e=>d.createElement(h.zx,{color:"secondary-neutral",size:ej(G),key:e.name,onClick:()=>{c.searchParams.routes[0].date=e.date,null==F||F({title:"search_form_date_hint_click",product:"bus",departure_date:eh(e.date)})}},e.name)))),d.createElement(to,{searchParams:c.searchParams,initiated:w.state.initiated,theme:m}),d.createElement("div",{className:Q.Z.submitButton},d.createElement(h.zx,Object.assign({isLoading:w.submitted,position:{lg:"right"},fullWidth:!0,color:"primary",type:"button","data-ti":"submit-button",onClick:L},eC(m)),O("find_tickets"))))}}))))};function tE(e){let{searchParams:t,busHost:a,busSuggestHost:n,calendarApiHost:l,holidaysApiHost:o,lastSearch:i,busSubmitter:u,suggestLoader:c,logError:d,renderEmptyFieldsOnSsr:m,onSubmit:p,busRootPath:h}=e,g=null!=i?i:new e7,f=(0,s.n)(a);return(0,r.sj)(new te({searchParams:t,suggest:new tt(null!=c?c:new s.B(null!=n?n:f),d),validator:new tr,lastSearch:g,searchParamsInitializer:new eK,submitter:u||new e8({busHost:f,onSubmit:p,busRootPath:h}),calendarApiHost:null!=l?l:(0,s.g)(f,"bus."),holidaysApiHost:void 0===o?(0,s.a)(f,"bus."):o,renderEmptyFieldsOnSsr:m}))}class tP extends el{constructor(e){super(e&&e.length?e:[{id:1,age:null},{id:2,age:null}])}get infantMaxAge(){return null}get childMaxAge(){return 17}}class tx{getInitialSearchParams(e){var t,a,r,n;let s=tO();if(!e)return s;let l=this.convertOuterSearchParams(e);return{point:null!==(t=l.point)&&void 0!==t?t:s.point,guests:null!==(a=l.guests)&&void 0!==a?a:s.guests,date:null!==(r=l.date)&&void 0!==r?r:s.date,secondDate:null!==(n=l.secondDate)&&void 0!==n?n:s.secondDate}}convertOuterSearchParams(e){let t;let{geoId:a,geoName:r,geoType:n,guests:s}=null!=e?e:{};return a&&"string"==typeof a&&r&&"string"==typeof r&&(t={id:a,name:r,geoType:n&&"string"==typeof n?n:null,type:"hotelDestination"}),Object.assign(Object.assign(Object.assign({},t?{point:t}:{}),{date:e.date,secondDate:e.secondDate}),s?{guests:new tP(s)}:{})}}function tO(){return{point:{type:"unknown",name:""},guests:new tP}}function tw(e){return!!e&&"object"==typeof e&&"type"in e&&"id"in e&&"name"in e&&"hotelDestination"===e.type&&eu(e.id)&&eu(e.name)}let tk=e=>{let{point:t,date:a,secondDate:r,guests:n}=e,s=tw(t)?`fid::${t.id};f::${t.name};ft::${t.geoType};`:"",l=ei(a)&&ei(r)?`d::${a};d2::${r};`:"",o=n.list.map(e=>{let{age:t}=e;return t}),i=n?`g::${JSON.stringify(o)};`:"";return`${s}${l}${i}`},tj=(e,t)=>{let a=null==e?void 0:e.split(";"),r={g:"[null]",f:"",fid:"",ft:"",d:void 0,d2:void 0};null==a||a.forEach(e=>{let[t,a]=e.split("::");t&&a&&(r[t]=a)});let n={type:"hotelDestination",name:r.f,id:r.fid,geoType:r.ft},s=tw(n)?n:t.point,l=es(r.g,[{id:1,age:null},{id:2,age:null}]),o=ec(r.d),i=ec(r.d2);return Object.assign({point:s,guests:new tP(l)},o&&i?{date:o,secondDate:i}:{})};class tC extends en{constructor(){super(...arguments),this.initialSearchParams=tO(),this.hotelCookieName="sf_hotel"}searchParamsToCookieValue(e){return tk(e)}cookieValueToSearchParams(e){return tj(e,this.initialSearchParams)}get cookieName(){return this.hotelCookieName}}class tN{constructor(e){this.params=e}gotoOffers(e){var t;this.hotelSearchId=(0,o.Z)();let{geoType:a}=e.point,r=Object.assign({searchId:this.searchId},this.getExternalSearchParams(e));this.openOffersPage(`${null!==(t=this.params.hotelDomain)&&void 0!==t?t:""}/${a&&"hotel"===a?(0,X.rO)(r):(0,X.M5)(r)}`)}openOffersPage(e){location.href=e}getExternalSearchParams(e){var t;let{adults:a,children:r}=e.guests.splitAdults(),n=r.map(e=>{let{age:t}=e;return t});return{geoId:Number(e.point.id),geoName:e.point.name,geoType:null!==(t=e.point.geoType)&&void 0!==t?t:null,checkInDate:eT(e.date),checkOutDate:eT(e.secondDate),guestsList:[{adultCount:a.length,childrenAgeList:n}]}}get searchId(){return this.hotelSearchId}}class tI{get fetch(){return function(){return fetch(...arguments)}}constructor(e){this.hotelApiHost=(0,s.n)(e)}getSuggestItems(e){return(0,u.mG)(this,arguments,void 0,function(e){var t=this;let{request:{value:a},abortController:r}=e;return function*(){let e=new URLSearchParams({query:a,limit:"8"});return function(e){if("object"!=typeof e||null===e)throw Error(`Unknown response format (type '${typeof e}')`);if(null===e.items)return[];if(Array.isArray(e.items))return e.items.map(e=>{var t,a;return{type:"geoPoint",geoPoint:{id:String(e.geoID),type:"hotelDestination",name:null!==(t=e.name)&&void 0!==t?t:"",geoType:null!==(a=e.geoType)&&void 0!==a?a:null},description:tz(e.parents),location:e.geoLocation,hotelsCount:e.hotelsCount}});throw Error(`Unknown response format (type '${typeof e.items}')`)}((yield t.fetch(`${t.hotelApiHost}/api/v1/suggest?${e}`,{method:"GET",redirect:"follow",signal:r.signal}).then(e=>e.json())))}()})}}let tz=function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[];return e.filter(e=>!!e.name).map(e=>e.name).join(", ")};class tS extends eo{constructor(e){var{suggest:t,calendarApiHost:a,holidaysApiHost:r}=e;super((0,u._T)(e,["suggest","calendarApiHost","holidaysApiHost"])),this.suggest=t,this.calendarApiHost=a,this.holidaysApiHost=r}}let tD=[{id:"2657260",name:"Москва",type:"locality",description:"Москва, Россия",location:{lat:55.755786,lon:37.617633}},{id:"2656915",name:"Санкт-Петербург",type:"locality",description:"Санкт-Петербург, Россия",location:{lat:59.939039,lon:30.315785}},{id:"2656918",name:"Сочи",type:"locality",description:"Краснодарский край, Россия",location:{lat:43.611599,lon:39.722489}},{id:"2656869",name:"Екатеринбург",type:"locality",description:"Свердловская область, Россия",location:{lat:56.837814,lon:60.596842}},{id:"2656912",name:"Ростов-на-Дону",type:"locality",description:"Ростовская область, Россия",location:{lat:47.233189,lon:39.715}},{id:"2656895",name:"Нижний Новгород",type:"locality",description:"Нижегородская область, Россия",location:{lat:56.329917,lon:44.009192}},{id:"2656873",name:"Казань",type:"locality",description:"Республика Татарстан, Россия",location:{lat:55.796538,lon:49.1082}},{id:"2656850",name:"Анапа",type:"locality",description:"Краснодарский край, Россия",location:{lat:44.89502,lon:37.331039}},{id:"2657201",name:"Симферополь",type:"locality",description:"Республика Крым, Крым",location:{lat:44.961818,lon:34.106572}},{id:"2656879",name:"Краснодар",type:"locality",description:"Краснодарский край, Россия",location:{lat:45.042149,lon:38.98064}},{id:"2665770",name:"Адлер",type:"locality",description:"Краснодарский край, Россия",location:{lat:43.4261,lon:39.9242}},{id:"2657137",name:"Минск",type:"locality",description:"Белоруссия",location:{lat:53.89994,lon:27.575569}},{id:"2656874",name:"Калининград",type:"locality",description:"Калининградская область, Россия",location:{lat:54.711595,lon:20.509972}},{id:"2686619",name:"Феодосия",type:"locality",description:"Республика Крым, Крым",location:{lat:45.0333,lon:35.3833}}];class t${constructor(e,t){this.loader=e,this.logError=t,this.currentItems=(0,r.sj)({items:[],prevRequest:null,abortController:null,isError:!1,isDefaultItems:!1}),this.loadItems=e=>(0,u.mG)(this,[e],void 0,function(e){var t=this;let{value:a}=e;return function*(){var e,n,s,l;try{let o={value:a},i=null===(e=t.currentItems)||void 0===e?void 0:e.prevRequest;if(!i||i.value!==o.value){null===(l=null===(s=null===(n=t.currentItems)||void 0===n?void 0:n.abortController)||void 0===s?void 0:s.abort)||void 0===l||l.call(s);let e=new AbortController;t.currentItems?(t.currentItems.abortController=(0,r.iH)(e),t.currentItems.prevRequest=o):t.currentItems={items:[],abortController:(0,r.iH)(e),prevRequest:o,isError:!1,isDefaultItems:!1};let a=yield t.getSuggestItems({request:o,abortController:e});if(a.length>0)t.currentItems.items=a,t.currentItems.isDefaultItems=!1;else{let e=new AbortController;t.currentItems.abortController=(0,r.iH)(e),t.currentItems.items=yield t.getSuggestItems({request:{value:""},abortController:e}),t.currentItems.isDefaultItems=!0}t.currentItems.isError=!1}}catch(e){if("name"in e&&("AbortError"===e.name||"CancelError"===e.name))return;if(t.currentItems.isError=!0,t.currentItems.items=[],t.logError)t.logError(e);else throw e}finally{t.currentItems.abortController=null}}()})}getSuggestItems(e){return e.request.value?this.loader.getSuggestItems(e):tD.map(e=>{let{id:t,type:a,name:r,description:n,location:s}=e;return{type:"geoPoint",geoPoint:{id:t,type:"hotelDestination",name:r,geoType:a},description:n,location:s}})}getItems(){var e,t,a,r,n,s;return{items:null!==(t=null===(e=this.currentItems)||void 0===e?void 0:e.items)&&void 0!==t?t:[],isError:null!==(r=null===(a=this.currentItems)||void 0===a?void 0:a.isError)&&void 0!==r&&r,isDefaultItems:null!==(s=null===(n=this.currentItems)||void 0===n?void 0:n.isDefaultItems)&&void 0!==s&&s}}}function tZ(e){let t={};return e.forEach(e=>{let a=function(e){switch(e){case"country":return"country";case"airport":return"airport";case"hotel":return"hotel";case"sight":return"sight";default:return"region"}}(e.geoPoint.geoType);Array.isArray(t[a])?t[a].push(e):t[a]=[e]}),Object.entries(t)}let tM=(0,c.S1)().rules({point:{requiredPoint:e=>!e||"unknown"===e.type},date:{requiredDate:e=>!e,dateFormat:e=>{if(8!==e.length&&10!==e.length)return!0;let[t,a,r]=e.split(".");return(null==t?void 0:t.length)!==2||2!==a.length||(null==r?void 0:r.length)!==2&&(null==r?void 0:r.length)!==4||isNaN(Number.parseInt(t,10))||isNaN(Number.parseInt(a,10))||isNaN(Number.parseInt(r,10))},datesAreEqual:(e,t)=>{let{data:{secondDate:a}}=t;return e&&a&&e===a},inPast:e=>{let[t,a,r]=e.split(".");return new Date(Number(r),Number(a)-1,Number(t),23,59,59).getTime()<new Date().getTime()}},secondDate:{requiredDate:e=>!e,dateFormat:e=>{if(8!==e.length&&10!==e.length)return!0;let[t,a,r]=e.split(".");return(null==t?void 0:t.length)!==2||2!==a.length||(null==r?void 0:r.length)!==2&&(null==r?void 0:r.length)!==4||isNaN(Number.parseInt(t,10))||isNaN(Number.parseInt(a,10))||isNaN(Number.parseInt(r,10))},datesAreEqual:(e,t)=>{let{data:{date:a}}=t;return a&&e&&a===e},inPast:e=>{let[t,a,r]=e.split(".");return new Date(Number(r),Number(a)-1,Number(t),23,59,59).getTime()<new Date().getTime()}}});class tT{validate(e){let t=tM.validate(e);return{result:t,isValid:null===t}}}let tA={arrival_city_error:"arrival_city_error",wrong_date:"wrong_date"},tF=e=>{var t;let a=e.result,r=[];return(null===(t=null==a?void 0:a.point)||void 0===t?void 0:t.requiredPoint)&&r.push(tA.arrival_city_error),((null==a?void 0:a.date)||(null==a?void 0:a.secondDate))&&r.push(tA.wrong_date),r},tR=()=>{let e=(0,y.Ei)(e=>a(21907)(`./${e}/index.json`));return d.createElement(d.Fragment,null,d.createElement("div",{className:(0,v.yl)(350)},d.createElement(I.P,{size:"paragraph-medium",hasExtraPaddingTop:!0},e("age_group_general_paragraph_1"))),d.createElement("div",{className:(0,v.yl)(200)},d.createElement(F.bL,{addonSize:"small",size:"medium",contrast:"plain"},d.createElement(F.hZ,{icon:"person-child"}),d.createElement(R.cM,{label:e("age_group_title_type_1"),emphasized:!0})),d.createElement(I.P,{size:"paragraph-medium"},e("age_group_paragraph_1_type_1"))))},tH=()=>{let{isOpen:e,setOpen:t}=(0,q.r)({initialIsOpen:!1}),r=(0,y.Ei)(e=>a(21907)(`./${e}/index.json`)),n=Array.from({length:18},(e,t)=>t),{userway:s}=(0,_.w5)();return d.createElement(d.Fragment,null,d.createElement(H.Rm,{sizeContrast:"medium-small",className:(0,m.Z)((0,v.yl)(200),(0,g.j)({xs:"none",lg:"flex"}))},d.createElement(R.cM,{emphasized:!0,isLabelAccent:!0,label:r("title-childrenModal")}),d.createElement(R.cM,{label:r("subtitle-childrenModal")})),d.createElement("div",{className:(0,v.yl)(200)},n.map(e=>d.createElement(B.h,{value:e,key:e},d.createElement(F.bL,{addonSize:"none",size:"medium",contrast:"small"},d.createElement(R.cM,{label:r("age",{found:0!==e,n:e}),emphasized:!0,expanded:!0}))))),d.createElement(h.zx,{className:(0,v.yl)(300),color:"secondary",size:400,firstLabel:r("age_informer_button"),fullWidth:!0,leftAddon:d.createElement(b.V,{icon:"info-circle"}),onClick:()=>{t(!e),null==s||s({title:"search_form_info_children_age_click",product:"hotels"})}}),d.createElement(G.u_,{isOpen:e,setOpen:t,title:r("why_choose_age"),hasBackButton:!1,size:"small"},d.createElement(tR,null)))},tq=e=>{let{maxAdultGuests:t,maxChildrenGuests:r,guests:s,onClose:l}=e,[o,i]=d.useState(!1),{adults:u,children:c}=(0,n.R)(s).splitAdults(),{userway:f}=(0,_.w5)(),E=u.length,P=(0,y.Ei)(e=>a(21907)(`./${e}/index.json`)),x=1===u.length,O=s.getCountsByType(),w=t<=O.adult,k=r<=O.child,j=e=>{s.remove(e)},C=()=>{i(!o),null==f||f({title:"search_form_add_child_click",product:"hotels"})};return d.createElement(d.Fragment,null,d.createElement(eW,{isMinusDisabled:x,isPlusDisabled:w,value:u.length,openPlusTooltipOnClick:w,plusTooltipContent:P("max_passengers",{count:t}),autoClosePlusTooltip:!0,autoCloseMinusTooltip:!0,title:P("adults"),subtitle:P("initial_adult_age"),className:(0,v.E9)(100),onMinusClick:()=>{null==f||f({title:"search_form_change_adults_click",product:"hotels",element_name:"minus",adult_count:E-1}),1!==E&&s.remove(u[u.length-1].id)},onPlusClick:()=>{null==f||f({title:"search_form_change_adults_click",product:"hotels",element_name:"plus",adult_count:E+1}),s.add(null)},onTooltipOpen:e=>{"plus"===e?null==f||f({title:"search_form_max_passengers_tooltip_shown",type:"special",product:"hotels"}):"minus"===e&&(null==f||f({title:"search_form_children_tooltip_shown",type:"special",product:"hotels"}))}}),c.map((e,t)=>{let{id:a,age:r}=e;return d.createElement(eB,{key:a,age:r,className:0!==t?(0,v.E9)(200):void 0,onDeleteClick:()=>{j(a),null==f||f({title:"search_form_remove_child_click",product:"hotels"})}})}),d.createElement(A.z,{containerStyle:{xs:"modal",lg:"dropdown"},size:700,onChange:e=>{s.add(e),i(!1)},isOpen:o,renderContent:()=>d.createElement(tH,null),setOpen:i,modalProps:{title:P("title-childrenModal"),subtitle:P("subtitle-childrenModal"),closeOnClickOutside:!0,closeOnCloseButtonClick:!0},dropdownProps:{closeOnClickOutside:!0,stopMouseDownPropagation:!0,useAvailableScreenHeight:!0,minHeight:"300px",minWidth:"330px"}},e=>{let{ref:t}=e;return d.createElement(h.zx,Object.assign({ref:t,className:(0,m.Z)((0,v.E9)(200),(0,v.yl)({xs:0,lg:300})),disabled:k,leftAddon:d.createElement(b.V,{icon:"person-child"}),size:400,color:"secondary",firstLabel:P("add_child_button"),onClick:C,fullWidth:!0},(0,p.ZP)("add_child_button")))}),d.createElement(h.zx,{className:(0,m.Z)((0,v.E9)(350),(0,g.j)({lg:"none"})),size:500,fullWidth:!0,color:"primary",type:"button",firstLabel:P("ready"),onClick:l}))},tL=e=>{let{searchParams:t,initiated:r,theme:s}=e,[l,o]=d.useState(!1),{userway:i}=(0,_.w5)(),u=(0,y.Ei)(e=>a(21907)(`./${e}/index.json`)),c=u("input_value",{count:(0,n.R)(t).guests.list.length}),m=()=>{null==i||i({title:"search_form_change_passengers_click",product:"hotels",passenger_count:t.guests.list.length})},p=()=>{o(!l)},h=()=>{null==i||i(Object.assign({title:"search_form_close_passengers_click",product:"hotels",passenger_count:t.guests.list.length,element_state:"other"},e_(t.guests)))},g=()=>{null==i||i(Object.assign({title:"search_form_close_passengers_click",product:"hotels",passenger_count:t.guests.list.length,element_state:"button"},e_(t.guests)))};return d.createElement(A.z,{size:700,containerStyle:{xs:"modal",lg:"dropdown"},isOpen:l,renderContent:()=>d.createElement(tq,{maxAdultGuests:6,maxChildrenGuests:4,guests:t.guests,onClose:()=>{o(!1),g()}}),setOpen:o,modalProps:{title:u("mobile_title"),closeOnClickOutside:!0,closeOnCloseButtonClick:!0,onClickOutside:h,minHeight:"auto",stopMouseDownPropagation:!1},dropdownProps:{closeOnClickOutside:!0,onClickOutside:h,position:"end",minWidth:"370px"}},e=>{let{ref:t}=e;return d.createElement(N.I,{wrapperClassName:`${K.Z.passengers} ${(0,v.yl)({xs:300,lg:0})}`,containerRef:t,position:{lg:"middle-horizontal",xl:"middle-horizontal"},"data-ti":"guests_input",type:"text",label:u("input_label"),value:r?c:"",onMouseDown:m,onFocus:p,readOnly:!0,clearButtonType:"hidden",wrapperProps:eC(s)})})},tV=(0,d.memo)(e=>{let{suggest:t}=e,r=(0,y.Ei)(e=>a(81970)(`./${e}/index.json`)),{items:s,isError:l}=(0,n.R)(t).getItems();return l&&0===s.length?d.createElement(U.vQ,null,r("error")):tZ(s).map(e=>{let[t,a]=e;return d.createElement(d.Fragment,{key:t},t&&d.createElement(U.to,null,d.createElement(I.Dr,{size:"header-xx-small"},r(t))),a.map(e=>d.createElement(U.uj,{value:e.geoPoint.id,key:e.geoPoint.id},d.createElement(H.Rm,null,d.createElement(R.cM,{label:e.geoPoint.name,value:"region"===t&&e.hotelsCount?e.hotelsCount:void 0,isLabelAccent:!0,emphasized:!0}),e.description&&d.createElement(R.cM,{label:e.description})))))})});function tB(e){let{suggest:t,searchParams:a}=e,r=(0,u._T)(e,["suggest","searchParams"]),{items:s,isDefaultItems:l}=(0,n.R)(t).getItems(),{point:o}=(0,n.R)(a,{sync:!0}),i=tZ(s).reduce((e,t)=>[...e,...t[1]],[]).map((e,t)=>({value:e.geoPoint.id,hiddenValue:Object.assign(Object.assign({},e),{index:t})})),c=(0,d.useCallback)(e=>{t.loadItems({value:e})},[t]);return d.createElement(eJ,Object.assign({},r,{point:o,setPoint:e=>{a.point=e},items:i,isDefaultItems:l,loadItems:c,renderContent:()=>d.createElement(tV,{suggest:t})}))}let tG={findHotels:"Найти отели",where:"Куда хотите поехать?",when:"Заезд\xa0—\xa0Выезд",requiredPoint:"Выберете место прибытия",requiredDate:"Выберите дату заезда и\xa0выезда",dateFormat:"Неправильный формат даты",datesAreEqual:"Даты заезда и\xa0выезда не\xa0должны совпадать",inPast:"Выберите не\xa0прошедшую дату"},tW=!1,tY=e=>e?(0,J.ZP)(tG,e):void 0,tU=["point","date","secondDate"],tJ=[{id:"2657260",type:"hotelDestination",name:"Москва",geoType:"locality"},{id:"2656915",type:"hotelDestination",name:"Санкт-Петербург",geoType:"locality"},{id:"2656918",type:"hotelDestination",name:"Сочи",geoType:"locality"}];function tQ(){let e=P()().add(1,"day").toDate(),t=P()().add(2,"day").toDate(),a=P()().add(3,"day").toDate();return[{name:eZ({dateFrom:e,dateTo:t}),date:eM(e),secondDate:eM(t)},{name:eZ({dateFrom:t,dateTo:a}),date:eM(t),secondDate:eM(a)}]}let tX=e=>{let{model:t,inputsTheme:r,size:s}=e,l=(0,y.Ei)(e=>a(44429)(`./${e}/index.json`)),o=(0,S.H)({min:"md"}),i=(0,n.R)(t),u=(0,D.n)({dateFrom:i.searchParams.date?eT(i.searchParams.date):null,dateTo:i.searchParams.secondDate?eT(i.searchParams.secondDate):null,onChangeDates:(0,d.useCallback)(e=>{t.searchParams.date=e.dateFrom?eM(e.dateFrom):void 0,t.searchParams.secondDate=e.dateTo?eM(e.dateTo):void 0},[t]),onlyRoundtrip:!0}),{validationEnabled:c}=i.state,{result:m}=c?i.validationResult:{result:null},{0:b,1:E}=(0,d.useState)(null),P=(()=>{if(!m)return null;if(b)for(let e=0;e<tU.length;e++){let t=tU[e];if(m[t]&&b===t)return t}for(let e=0;e<tU.length;e++){let t=tU[e];if(m[t])return t}return null})(),{userway:x}=(0,_.w5)(),{0:O,1:w}=(0,d.useState)({point:!1,date:!1}),k=()=>{var e;(null===(e=t.validationResult)||void 0===e?void 0:e.isValid)||null==x||x({title:"search_form_error_shown",type:"special",product:"hotels",validation_errors:tF(i.validationResult)}),t.submit(),E(null),w({point:!1,date:!1});let{date:a,secondDate:r,point:n}=t.searchParams,s="hotelDestination"===n.type?{arrival_geo_id:n.id}:{},{searchId:l}=t.submitter;null==x||x(Object.assign(Object.assign(Object.assign(Object.assign(Object.assign({title:"search_form_search_click",product:"hotels",search_id:l},s),ef(a)),eb(r)),{route_type:"roundtrip",passenger_count:t.searchParams.guests.list.length}),e_(t.searchParams.guests)))},j=("date"===P||"secondDate"===P)&&!O.date,C=(0,d.useCallback)(()=>{w(e=>Object.assign(Object.assign({},e),{date:!0}))},[]);ex({enabled:j,callback:C}),(0,d.useEffect)(()=>{if(t.init(),!tW){let{date:e,secondDate:a,point:r}=t.searchParams;null==x||x(Object.assign(Object.assign(Object.assign(Object.assign(Object.assign({title:"search_form_first_shown",product:"hotels"},(null==r?void 0:r.type)==="hotelDestination"?{arrival_geo_id:r.id}:{}),ef(e)),eb(a)),{route_type:"roundtrip",passenger_count:t.searchParams.guests.list.length}),e_(t.searchParams.guests))),tW=!0}},[]);let $=(0,d.useMemo)(tQ,[]),Z=ew(s);return d.createElement(f.cw,Object.assign({size:Z,layout:{xs:"vertical",md:"vertical",lg:"vertical",xl:"horizontal"}},(0,p.ZP)("hotel-search-form")),d.createElement("div",{className:K.Z.searchForm},d.createElement(D.S,Object.assign({},u,{disableSameDates:!0,withAnimation:!1,product:"hotel",block:"search_form",hideTripTypeText:!0,maximumRangeLength:30,maximumRangeLengthBefore:30,apiHost:i.calendarApiHost,calendarHost:i.holidaysApiHost,isDesktop:null==o||o,popupContentClassName:K.Z.calendarPopup,target:e=>{var a,n,s,o,b,_,y,S,D;let{fromRef:M}=e;return d.createElement(d.Fragment,null,d.createElement("div",{className:`${K.Z.firstSubGroup} ${(0,f.dm)({lg:["bottom"],xl:["none"]})}`},d.createElement("div",{className:K.Z.departure},d.createElement(tB,{product:"hotel",fieldName:"to",position:{xs:"top",lg:"single",xl:"left"},label:l("where"),searchParams:t.searchParams,suggest:t.suggest,hasError:!!(null==m?void 0:m.point),errorMessage:"point"!==P||O.point?void 0:tY(null===(s=null===(n=null===(a=null==m?void 0:m.point)||void 0===a?void 0:a.errors)||void 0===n?void 0:n[0])||void 0===s?void 0:s.type),onFocus:()=>{c&&E("from")},tabIndex:0,onErrorMessageClose:()=>{w(e=>Object.assign(Object.assign({},e),{point:!0}))},theme:r}),d.createElement("div",{className:`${(0,g.j)({xs:"none",xl:"inline-flex"})} ${(0,v.E9)(200)} ${(0,v.SG)(100)}`},tJ.map(e=>d.createElement(h.zx,Object.assign({color:"secondary-neutral",size:ej(Z),key:e.name,onClick:()=>{t.searchParams.point=e,null==x||x({title:"search_form_city_hint_click",product:"hotels",geo_id:e.id,block:"arrival"})}},(0,p.ZP)("toHint")),e.name))))),d.createElement("div",{className:K.Z.secondSubGroup},d.createElement("div",{className:`${K.Z.targetDate}`},d.createElement(z.X,{open:j,content:d.createElement(I.Dr,{color:"primary"},tY(null===(_=null===(b=null===(o=null==m?void 0:m.date)||void 0===o?void 0:o.errors)||void 0===b?void 0:b[0])||void 0===_?void 0:_.type)||tY(null===(D=null===(S=null===(y=null==m?void 0:m.secondDate)||void 0===y?void 0:y.errors)||void 0===S?void 0:S[0])||void 0===D?void 0:D.type)),side:"top",onClick:C,onClickOutside:C,position:"start",targetRef:M},e=>{var t;let{ref:a}=e;return d.createElement(N.I,{wrapperClassName:`${K.Z.date} ${(0,f.dm)({xs:["bottom"],lg:["none"]})}`,wrapperProps:eC(r),position:{xs:"bottom",lg:"left",xl:"middle-horizontal"},containerRef:a,"data-ti":"trip-dates",type:"text",label:l("when"),value:e$({dateFrom:u.chosenDates.dateFrom,dateTo:u.chosenDates.dateTo}),onChange:()=>{},hasError:c&&(!!(null==m?void 0:m.date)||!!(null==m?void 0:m.secondDate)),onClear:()=>{u.clearDate()},onFocus:()=>{c&&E("date")},tabIndex:0,readOnly:!0,clearButtonType:{xs:"hidden",lg:u.chosenDates.focusedInput&&(null===(t=u.chosenDates)||void 0===t?void 0:t.dateFrom)?"force":"hidden"}})}),d.createElement("div",{className:`${(0,g.j)({xs:"none",xl:"inline-flex"})} ${(0,v.E9)(200)} ${(0,v.SG)(100)}`},$.map(e=>d.createElement(h.zx,Object.assign({color:"secondary-neutral",size:ej(Z),key:e.name},(0,p.ZP)("dateHint"),{onClick:a=>{a.stopPropagation(),t.searchParams.date=e.date,t.searchParams.secondDate=e.secondDate,null==x||x({title:"search_form_date_hint_click",product:"hotels",departure_date:eh(e.date),arrival_date:eh(e.secondDate)})}}),e.name)))),d.createElement(tL,{searchParams:t.searchParams,initiated:i.state.initiated,theme:r}),d.createElement("div",{className:K.Z.submitButton},d.createElement(h.zx,{isLoading:i.submitted,position:{lg:"right"},fullWidth:!0,color:"primary",type:"button","data-ti":"submit-button",onClick:k},l("findHotels")))))}}))))};function tK(e){let{searchParams:t,hotelSuggestHost:a,hotelHost:n,lastSearch:l,hotelSubmitter:o,suggestLoader:i,logError:u,renderEmptyFieldsOnSsr:c,holidaysApiHost:d}=e,m=null!=l?l:new tC,p=(0,s.n)(n);return(0,r.sj)(new tS({searchParams:t,suggest:new t$(null!=i?i:new tI(null!=a?a:(0,s.b)(p,"hotel.")),u),validator:new tT,lastSearch:m,searchParamsInitializer:new tx,submitter:o||new tN({hotelDomain:p}),holidaysApiHost:void 0===d?(0,s.a)(p,"hotel."):d,renderEmptyFieldsOnSsr:c}))}class t0 extends el{get infantMaxAge(){return 4}get childMaxAge(){return 11}}class t1{getInitialSearchParams(e){var t,a;let r=t2();if(!e)return r;let n=this.convertOuterSearchParams(e);return{routes:null!==(t=n.routes)&&void 0!==t?t:r.routes,passengers:null!==(a=n.passengers)&&void 0!==a?a:r.passengers}}convertOuterSearchParams(e){let t=null==e?void 0:e.routes[0];return Object.assign(Object.assign({routes:[{from:t.from?{type:"trainStation",name:t.from.value,rzdNumber:t.from.id}:{type:"unknown",name:""},to:t.to?{type:"trainStation",name:t.to.value,rzdNumber:t.to.id}:{type:"unknown",name:""},date:null==t?void 0:t.date}]},(null==e?void 0:e.searchId)?{searchId:e.searchId}:{}),e.passengers?{passengers:new t0(e.passengers)}:{})}}function t2(){return{routes:[{from:{type:"unknown",name:""},to:{type:"unknown",name:""},date:void 0}],passengers:new t0}}function t9(e){return!!e&&void 0!==e.rzdNumber}function t5(e){return!!e&&"object"==typeof e&&!!("rzdNumber"in e&&"name"in e&&eu(e.rzdNumber)&&eu(e.name))}let t3=(e,t)=>{let{date:a}=e,r=t5(e.from)?e.from:t.from,n=t5(e.to)?e.to:t.to,s=t9(r)?`ftid::${r.rzdNumber};`:"",l=t9(n)?`ttid::${n.rzdNumber};`:"",o=eu(r.name)?`f::${r.name};`:"",i=eu(n.name)?`t::${n.name};`:"",u=ei(a)?`d::${a};`:"";return`${o}${s}${i}${l}${u}`},t6=(e,t)=>{let{routes:a,passengers:r}=e,n=t3(a[0],t.routes[0]),s=r.list.map(e=>{let{age:t}=e;return t}),l=r?`p::${JSON.stringify(s)};`:"";return`${l}${n}`},t4=(e,t)=>{let a=null==e?void 0:e.split(";"),r={p:"[null]",f:"",ftid:"",ft:"",t:"",ttid:"",tt:"",d:void 0};null==a||a.forEach(e=>{let[t,a]=e.split("::");t&&a&&(r[t]=a)});let n={type:"trainStation",name:r.f,rzdNumber:r.ftid},s={type:"trainStation",name:r.t,rzdNumber:r.ttid},l=t5(n)?n:t.routes[0].from,o=t5(s)?s:t.routes[0].to,i=es(r.p);return{routes:[{from:l,to:o,date:ec(r.d)}],passengers:new t0(i)}};class t7 extends en{constructor(){super(...arguments),this.initialSearchParams=t2(),this.trainCookieName="sf_train"}searchParamsToCookieValue(e){return t6(e,this.initialSearchParams)}cookieValueToSearchParams(e){return t4(e,this.initialSearchParams)}get cookieName(){return this.trainCookieName}}class t8{constructor(e){this.params=e}gotoOffers(e){var t,a;if(this.trainSearchId=(0,o.Z)(),null===(a=(t=this.params).onSubmit)||void 0===a?void 0:a.call(t,this.getOuterSearchParams(e)))return;let r=e.routes[0];this.openOffersPage((0,i.Ro)(Object.assign(Object.assign({mainDomain:this.params.mainDomain.replace("https://","").replace("http://","")},(null==r?void 0:r.date)?{searchId:this.searchId}:{}),this.getExternalSearchParams(e))))}openOffersPage(e){location.href=e}getOuterSearchParams(e){return{routes:e.routes.map(e=>({date:e.date,from:{id:e.from.rzdNumber,value:e.from.name},to:{id:e.to.rzdNumber,value:e.to.name}})),passengers:0===e.passengers.list.length?[...new t0().list]:[...e.passengers.list]}}getExternalSearchParams(e){return{trips:e.routes.map(e=>({date:e.date,from:{id:e.from.rzdNumber,value:e.from.name},to:{id:e.to.rzdNumber,value:e.to.name}})),passengers:0===e.passengers.list.length?[...new t0().list]:[...e.passengers.list]}}get searchId(){return this.trainSearchId}}class ae extends ed{constructor(e){var{suggest:t,salePeriod:a,calendarApiHost:n,holidaysApiHost:s}=e;super((0,u._T)(e,["suggest","salePeriod","calendarApiHost","holidaysApiHost"])),this.suggest=t,this.calendarApiHost=n,this.holidaysApiHost=s,this.salePeriod=(0,r.sj)(a),(0,r.Ld)(this.searchParams,()=>{this.loadSalePeriodData()})}loadSalePeriodData(){if(!this.salePeriod)return;let e=this.searchParams.routes[0];if("trainStation"===e.from.type&&"trainStation"===e.to.type){let t={from:e.from.rzdNumber,to:e.to.rzdNumber};this.salePeriod.loadData(t)}}}class at{constructor(e,t){this.loader=e,this.logError=t,this.data={period:void 0}}loadData(e){return(0,u.mG)(this,void 0,void 0,function*(){try{this.data=yield this.loader.getData(e)}catch(e){if(this.logError)this.logError(e);else throw e}})}getData(){return this.data}}class aa extends ep{constructor(e,t,a){super(a),this.loader=e,this.relevantLoader=t}getSuggestItems(e){return""===e.request.value?this.relevantLoader.getSuggestItems(e):this.loader.getSuggestItems(e)}}let ar=(0,c.S1)().rules({routes:(0,c.pb)((0,c.S1)().rules({from:{requiredFrom:e=>!e||"unknown"===e.type},to:{requiredTo:e=>!e||"unknown"===e.type}}))});class an{validate(e){let t=ar.validate(e);return{result:t,isValid:null===t}}}let as=(0,d.memo)(e=>{let{fieldName:t,suggest:r}=e,s=(0,y.Ei)(e=>a(31453)(`./${e}/index.json`)),{items:l,isError:o}=(0,n.R)(r).getItems({fieldName:t});return o&&0===l.length?d.createElement(U.vQ,null,s("error")):l.map(e=>d.createElement(U.uj,{value:e.geoPoint.rzdNumber,key:e.geoPoint.rzdNumber},d.createElement(F.bL,{addonSize:"none"},d.createElement(R.cM,Object.assign({label:e.geoPoint.name,isLabelAccent:!0,emphasized:!0},(0,p.ZP)("suggest-item-name"))))))});function al(e){let{fieldName:t,searchParams:a,suggest:r,routeIndex:s=0}=e,l=(0,u._T)(e,["fieldName","searchParams","suggest","routeIndex"]),o=(0,n.R)(r),{items:i,isDefaultItems:c}=o.getItems({fieldName:t}),m=(0,n.R)(a,{sync:!0}).routes[s],p=m["from"===t?"to":"from"],h=i.map((e,t)=>({value:e.geoPoint.rzdNumber,hiddenValue:Object.assign(Object.assign({},e),{index:t})})),g=(0,d.useCallback)(e=>{o.loadItems({value:e,fieldName:t,relatedField:p,routeIndex:s})},[t,p,s,o]);return d.createElement(eJ,Object.assign({},l,{fieldName:t,point:m[t],setPoint:e=>{a.routes[s][t]=e},isDefaultItems:c,items:h,loadItems:g,renderContent:()=>d.createElement(as,{fieldName:t,suggest:r}),searchId:null==a?void 0:a.searchId}))}let ao={find_tickets:"Найти билеты",today:"Сегодня",tomorrow:"Завтра",from:"Откуда",to:"Куда",when:"Когда",select_departure_location:"Выберите место отправления",select_arrival_location:"Выберите место прибытия",swapGeoPoints:"Поменять местами отправление и прибытие"},ai={requiredFrom:(0,J.ZP)(ao,"select_departure_location"),requiredTo:(0,J.ZP)(ao,"select_arrival_location")},au=["from","to"],ac={rzdNumber:"2000000",name:"Москва",type:"trainStation",translitName:"Moskva"},ad={rzdNumber:"2004000",name:"Санкт-Петербург",type:"trainStation",translitName:"Sankt-peterburg"},am=!1,ap=[ac,ad],ah=[ad,ac],ag=new Date,af=new Date(ag.getFullYear(),ag.getMonth(),ag.getDate()+1),ab=[{name:(0,J.ZP)(ao,"today"),date:eM(ag)},{name:(0,J.ZP)(ao,"tomorrow"),date:eM(af)}],av=e=>{var t,r,s,l,o,i,u,c,E;let{model:P,inputsTheme:x,hideHints:O,size:w}=e,k=(0,S.H)({min:"md"}),j=(0,y.Ei)(e=>a(12229)(`./${e}/index.json`)),C=(0,n.R)(P),{userway:I}=(0,_.w5)(),{0:z,1:$}=(0,d.useState)({from:!1,to:!1}),Z=(0,D.n)({dateFrom:C.searchParams.routes[0].date?eT(C.searchParams.routes[0].date):null,onChangeDates:(0,d.useCallback)(e=>{P.searchParams.routes[0].date=e.dateFrom?eM(e.dateFrom):void 0},[P]),isOneway:!0}),M={from:C.searchParams.routes[0].from.rzdNumber,to:C.searchParams.routes[0].to.rzdNumber},{validationEnabled:T}=C.state,A=T?C.validationResult.result:null,{0:F,1:R}=(0,d.useState)(null),H=null===(t=null==A?void 0:A.routes)||void 0===t?void 0:t[0],q=null===(s=null===(r=C.salePeriod)||void 0===r?void 0:r.getData())||void 0===s?void 0:s.period,L=(()=>{if(!H)return null;if(F)for(let e=0;e<au.length;e++){let t=au[e];if(H[t]&&F===t)return t}for(let e=0;e<au.length;e++){let t=au[e];if(H[t])return t}return null})(),V=null===(i=null===(o=null===(l=null==H?void 0:H.from)||void 0===l?void 0:l.errors)||void 0===o?void 0:o[0])||void 0===i?void 0:i.type,B="from"!==L||z.from?void 0:ai[V],G=null===(E=null===(c=null===(u=null==H?void 0:H.to)||void 0===u?void 0:u.errors)||void 0===c?void 0:c[0])||void 0===E?void 0:E.type,W="to"!==L||z.to?void 0:ai[G],Y=()=>{P.swapGeoPoints(),null==I||I({title:"search_form_change_destination_click",product:"train"})},U=()=>{var e;(null===(e=P.validationResult)||void 0===e?void 0:e.isValid)||null==I||I({title:"search_form_error_shown",type:"special",product:"train",validation_errors:eP(C.validationResult)}),P.submit(),R(null),$({from:!1,to:!1});let{from:t,to:a,date:r}=P.searchParams.routes[0],n="trainStation"===t.type?{departure_geo_id:t.rzdNumber}:{},s="trainStation"===a.type?{arrival_geo_id:a.rzdNumber}:{},{searchId:l}=P.submitter;null==I||I(Object.assign(Object.assign(Object.assign(Object.assign(Object.assign({title:"search_form_search_click",product:"train",search_id:l},n),s),ef(r)),{route_type:"oneway",passenger_count:P.searchParams.passengers.list.length}),e_(P.searchParams.passengers)))},J=(e,t)=>{P.searchParams.routes[0][e]=t,null==I||I(Object.assign({title:"search_form_city_hint_click",product:"train",geo_id:t.rzdNumber},ev(e)))},Q=e=>{P.searchParams.routes[0].date=e,null==I||I({title:"search_form_date_hint_click	",product:"train",departure_date:eh(e)})};(0,d.useEffect)(()=>{if(P.init(),P.loadSalePeriodData(),!am){let{from:e,to:t,date:a}=P.searchParams.routes[0],r="trainStation"===e.type?{departure_geo_id:e.rzdNumber}:{},n="trainStation"===t.type?{arrival_geo_id:t.rzdNumber}:{};null==I||I(Object.assign(Object.assign(Object.assign(Object.assign(Object.assign({title:"search_form_first_shown",product:"train"},r),n),ef(a)),{route_type:"oneway",passenger_count:P.searchParams.passengers.list.length}),e_(P.searchParams.passengers))),am=!0}},[P,I]);let X=ew(w);return d.createElement(f.cw,Object.assign({size:X,layout:{xs:"vertical",xl:"horizontal"}},(0,p.ZP)("train-search-form")),d.createElement("div",{className:ee.Z.searchForm},d.createElement(D.S,Object.assign({},Z,{withAnimation:!1,highlightFutureDates:!0,highlightPastDates:!0,showPastDatesMobile:!0,salePeriod:q,disabledPastDays:!1,product:"train",block:"search_form",apiHost:C.calendarApiHost,calendarHost:C.holidaysApiHost,isDesktop:null==k||k,cityIds:M,popupContentClassName:ee.Z.calendarPopup,target:e=>{var t,a,r;let{fromRef:n}=e;return d.createElement("div",{className:ee.Z.firstSubGroup},d.createElement("div",{className:ee.Z.departure},d.createElement(al,{product:"train",position:{xs:"top",lg:"left"},label:j("from"),fieldName:"from",searchParams:P.searchParams,suggest:P.suggest,hasError:!!(null==H?void 0:H.from),errorMessage:B,onFocus:()=>{T&&R("from")},tabIndex:0,onErrorMessageClose:()=>{$(e=>Object.assign(Object.assign({},e),{from:!0}))},theme:x}),!O&&d.createElement("div",{className:`${(0,g.j)({xs:"none",xl:"inline-flex"})} ${(0,v.E9)(200)} ${(0,v.SG)(100)}`},ap.map(e=>d.createElement(h.zx,{color:"secondary-neutral",size:ej(X),key:e.name,onClick:()=>J("from",e)},e.name)))),d.createElement(h.zx,Object.assign({"aria-label":j("swapGeoPoints"),className:`${ee.Z.switcher} ${(0,g.j)({xs:"inline-flex",lg:"none"})}`,accent:"default",color:"outline-form",leftAddon:d.createElement(b.V,{icon:"arrow-2-up-down_outline"}),size:ek(X),onClick:Y,tabIndex:0},(0,p.ZP)("swapButton"),eC(x))),d.createElement(h.zx,Object.assign({"aria-label":j("swapGeoPoints"),position:{lg:"middle-horizontal"},className:`${ee.Z.switcher} ${(0,g.j)({xs:"none",lg:"inline-flex"})}`,accent:"default",color:"outline-form",leftAddon:d.createElement(b.V,{icon:"arrow-2-left-right_outline"}),size:X,onClick:Y,tabIndex:0},(0,p.ZP)("swapButton"),eC(x))),d.createElement("div",{className:ee.Z.arrival},d.createElement(al,{product:"train",position:{xs:"middle-vertical",lg:"right",xl:"middle-horizontal"},label:j("to"),fieldName:"to",searchParams:P.searchParams,suggest:P.suggest,hasError:!!(null==H?void 0:H.to),errorMessage:W,onFocus:()=>{T&&R("to")},tabIndex:0,onErrorMessageClose:()=>{$(e=>Object.assign(Object.assign({},e),{to:!0}))},theme:x}),!O&&d.createElement("div",{className:`${(0,g.j)({xs:"none",xl:"inline-flex"})} ${(0,v.E9)(200)} ${(0,v.SG)(100)}`},ah.map(e=>d.createElement(h.zx,{color:"secondary-neutral",size:ej(X),key:e.name,onClick:()=>J("to",e)},e.name)))),d.createElement("div",{className:(0,m.Z)(ee.Z.targetDate,(0,g.j)({lg:"flex",xl:"block"}),(0,f.dm)({lg:["top"],xl:["none"]}))},d.createElement("div",{ref:n,className:ee.Z.dateWrapper},d.createElement(N.I,{wrapperClassName:`${ee.Z.date} ${(0,v.yl)({xs:300,lg:0})}`,wrapperProps:eC(x),position:{xs:"bottom",lg:"left",xl:"middle-horizontal"},"data-ti":"trip-dates",type:"text",label:j("when"),value:e$({dateFrom:null===(t=Z.chosenDates)||void 0===t?void 0:t.dateFrom,dateTo:null===(a=Z.chosenDates)||void 0===a?void 0:a.dateTo}),onChange:()=>{},onClear:()=>{Z.clearDate()},tabIndex:0,readOnly:!0,clearButtonType:{xs:"hidden",lg:"from"===Z.chosenDates.focusedInput&&(null===(r=Z.chosenDates)||void 0===r?void 0:r.dateFrom)?"force":"hidden"}})),!O&&d.createElement("div",{className:`${(0,g.j)({xs:"none",xl:"inline-flex"})} ${(0,v.E9)(200)} ${(0,v.SG)(100)}`},ab.map(e=>d.createElement(h.zx,{color:"secondary-neutral",size:ej(X),key:e.name,onClick:()=>Q(e.date)},e.name))),d.createElement("div",{className:(0,m.Z)(ee.Z.submitButton,(0,g.j)({xs:"none",lg:"block",xl:"none"}))},d.createElement(h.zx,Object.assign({className:`${(0,f.dm)({xs:["top"],lg:["none"]})}`,isLoading:C.submitted,position:{lg:"right"},fullWidth:!0,type:"button","data-ti":"submit-button",onClick:U},eC(x)),j("find_tickets")))),d.createElement("div",{className:(0,m.Z)(ee.Z.submitButton,(0,g.j)({lg:"none",xl:"block"}))},d.createElement(h.zx,Object.assign({isLoading:C.submitted,position:{lg:"right"},fullWidth:!0,type:"button","data-ti":"submit-button",onClick:U},eC(x)),j("find_tickets"))))}}))))},a_=()=>{let e=(0,y.Ei)(e=>a(15967)(`./${e}/index.json`));return d.createElement(d.Fragment,null,d.createElement("div",{className:(0,v.yl)(350)},d.createElement(I.P,{size:"paragraph-medium",hasExtraPaddingTop:!0},e("age_group_general_paragraph_1")),d.createElement(I.P,{size:"paragraph-medium"},e("age_group_general_paragraph_2"))),d.createElement("div",{className:(0,v.yl)(200)},d.createElement(F.bL,{addonSize:"small",size:"medium",contrast:"plain"},d.createElement(F.hZ,{icon:"person-child-stroller"}),d.createElement(R.cM,{label:e("age_group_title_type_1"),emphasized:!0})),d.createElement(I.P,{size:"paragraph-medium"},e("age_group_paragraph_1_type_1")),d.createElement(I.P,{size:"paragraph-medium",hasExtraPaddingTop:!0},e("age_group_paragraph_2_type_1"))),d.createElement("div",{className:(0,v.yl)(200)},d.createElement(F.bL,{addonSize:"small",size:"medium",contrast:"plain"},d.createElement(F.hZ,{icon:"person-child-stroller"}),d.createElement(R.cM,{label:e("age_group_title_type_2"),emphasized:!0})),d.createElement(I.P,{size:"paragraph-medium"},e("age_group_paragraph_type_2"))),d.createElement("div",{className:(0,v.yl)(200)},d.createElement(F.bL,{addonSize:"small",size:"medium",contrast:"plain"},d.createElement(F.hZ,{icon:"person-child"}),d.createElement(R.cM,{label:e("age_group_title_type_3"),emphasized:!0})),d.createElement(I.P,{size:"paragraph-medium",hasExtraPaddingTop:!0},e("age_group_paragraph_type_3"))))},ay=e=>{let{hasValidAgePassenger:t}=e,{isOpen:r,setOpen:n}=(0,q.r)({initialIsOpen:!1}),s=(0,y.Ei)(e=>a(15967)(`./${e}/index.json`)),l=Array.from({length:12},(e,t)=>t),o=l.slice(0,5),i=l.slice(5,l.length),{userway:u}=(0,_.w5)();return d.createElement(d.Fragment,null,d.createElement(H.Rm,{sizeContrast:"medium-small",className:(0,m.Z)((0,v.yl)(200),(0,g.j)({xs:"none",lg:"flex"}))},d.createElement(R.cM,{emphasized:!0,isLabelAccent:!0,label:s("title-childrenModal")}),d.createElement(R.cM,{label:s("subtitle-childrenModal")})),d.createElement("div",{className:(0,v.yl)(200)},d.createElement(F.bL,{addonSize:"small",size:"medium",contrast:"small",hasSeparator:!0},d.createElement(F.hZ,{iconStyle:"secondary",icon:"person-child-stroller"}),d.createElement(R.cM,{labelColor:"secondary",emphasized:!0,label:s("without_place")})),o.map(e=>d.createElement(B.h,{value:e,key:e,disabled:!t},d.createElement(F.bL,{addonSize:"none",size:"medium",contrast:"small"},d.createElement(R.cM,{labelColor:t?"primary":"secondary",label:s("age",{found:0!==e,n:e}),expanded:!0,emphasized:!0}))))),d.createElement("div",{className:(0,v.yl)(200)},d.createElement(F.bL,{addonSize:"small",size:"medium",contrast:"small",hasSeparator:!0},d.createElement(F.hZ,{iconStyle:"secondary",icon:"person-child"}),d.createElement(R.cM,{labelColor:"secondary",emphasized:!0,label:s("with_place")})),i.map(e=>d.createElement(d.Fragment,{key:e},d.createElement(B.h,{value:e,disabled:!t&&e<10},d.createElement(F.bL,{addonSize:"none",size:"medium",contrast:"small"},d.createElement(R.cM,{labelColor:t||e>=10?"primary":"secondary",label:s("age",{found:0!==e,n:e}),emphasized:!0,expanded:!0}))),!t&&9===e&&d.createElement(eY,Object.assign({text:s("min_valid_age_passenger_alert")},(0,p.ZP)("min_valid_age_passenger_alert")))))),d.createElement(h.zx,{className:(0,v.yl)(300),color:"secondary",size:400,firstLabel:s("age_informer_button"),fullWidth:!0,leftAddon:d.createElement(b.V,{icon:"info-circle"}),onClick:()=>{n(!r),null==u||u({title:"search_form_info_children_age_click",product:"train"})}}),d.createElement(G.u_,{isOpen:r,setOpen:n,title:s("why_choose_age"),hasBackButton:!1,size:"small"},d.createElement(a_,null)))},aE=e=>{let{maxPassengers:t,passengers:r,onClose:s}=e,[l,o]=d.useState(!1),{userway:i}=(0,_.w5)(),u=(0,n.R)(r),c=(0,y.Ei)(e=>a(15967)(`./${e}/index.json`)),{adults:f,children:E}=u.splitAdults(),P=f.length,x=t<=u.list.length,O=[...u.list].reduce((e,t)=>null===t.age||t.age>=10?Object.assign(Object.assign({},e),{valid:[...e.valid,t]}):Object.assign(Object.assign({},e),{invalid:[...e.invalid,t]}),{valid:[],invalid:[]}),w=O.valid.length>0,k=O.invalid.length>0,j=1===P&&1===O.valid.length&&k,C=0===f.length||j,N=[c("min_valid_age_passenger_tooltip_part_1"),c("min_valid_age_passenger_tooltip_part_2")],I=e=>{r.remove(e)},z=()=>{o(!l),null==i||i({title:"search_form_add_child_click",product:"train"})};return d.createElement(d.Fragment,null,d.createElement(eW,{isMinusDisabled:C,isPlusDisabled:x,value:f.length,openPlusTooltipOnClick:x,openMinusTooltipOnClick:j,plusTooltipContent:c("max_passengers",{count:t}),minusTooltipContent:N,autoClosePlusTooltip:!0,autoCloseMinusTooltip:!0,title:c("adults"),subtitle:c("initial_adult_age"),className:(0,v.E9)(100),onMinusClick:()=>{null==i||i({title:"search_form_change_adults_click",product:"train",element_name:"minus",adult_count:P-1}),C||r.remove(f[f.length-1].id)},onPlusClick:()=>{null==i||i({title:"search_form_change_adults_click",product:"train",element_name:"plus",adult_count:P+1}),r.add(null)},onTooltipOpen:e=>{"plus"===e?null==i||i({title:"search_form_max_passengers_tooltip_shown",product:"train",type:"special"}):"minus"===e&&(null==i||i({title:"search_form_children_tooltip_shown",product:"train",type:"special"}))}}),E.map((e,t)=>{let{id:a,age:r}=e,n=0===P&&1===O.valid.length&&k&&r>=10;return d.createElement(eB,{key:a,age:r,infantMaxAge:4,className:0!==t?(0,v.E9)(200):void 0,isDeleteDisabled:n,deleteTooltipContent:N,openDeleteTooltipOnClick:n,autoCloseDeleteTooltip:!0,deleteTooltipPosition:"middle",deleteTooltipSide:"left",onDeleteClick:()=>{n||(I(a),null==i||i({title:"search_form_remove_child_click",product:"train"}))}})}),d.createElement(A.z,{containerStyle:{xs:"modal",lg:"dropdown"},size:700,onChange:e=>{r.add(e),o(!1)},isOpen:l,renderContent:()=>d.createElement(ay,{hasValidAgePassenger:w}),setOpen:o,modalProps:{title:c("title-childrenModal"),subtitle:c("subtitle-childrenModal"),closeOnClickOutside:!0,closeOnCloseButtonClick:!0},dropdownProps:{closeOnClickOutside:!0,stopMouseDownPropagation:!0,useAvailableScreenHeight:!0,minHeight:"300px",minWidth:"330px"}},e=>{let{ref:t}=e;return d.createElement(h.zx,Object.assign({ref:t,className:(0,m.Z)((0,v.E9)(200),(0,v.yl)({xs:0,lg:300})),disabled:x,leftAddon:d.createElement(b.V,{icon:"person-child"}),size:400,color:"secondary",firstLabel:c("add_child_button"),onClick:z,fullWidth:!0},(0,p.ZP)("add_child_button")))}),d.createElement(h.zx,{className:(0,m.Z)((0,v.E9)(350),(0,g.j)({lg:"none"})),size:500,fullWidth:!0,color:"primary",type:"button",firstLabel:c("ready"),onClick:s}))},aP=e=>{let{searchParams:t,initiated:r,theme:s}=e,[l,o]=d.useState(!1),{userway:i}=(0,_.w5)(),u=(0,y.Ei)(e=>a(15967)(`./${e}/index.json`)),c=(0,n.R)(t),m=u("input_value",{count:c.passengers.list.length}),p=()=>{null==i||i({title:"search_form_change_passengers_click",product:"train",passenger_count:t.passengers.list.length})},h=()=>{o(!l)},g=()=>{null==i||i(Object.assign({title:"search_form_close_passengers_click",product:"train",passenger_count:t.passengers.list.length,element_state:"other"},e_(t.passengers)))},f=()=>{null==i||i(Object.assign({title:"search_form_close_passengers_click",product:"train",passenger_count:c.passengers.list.length,element_state:"button"},e_(t.passengers)))};return d.createElement(A.z,{size:700,containerStyle:{xs:"modal",lg:"dropdown"},isOpen:l,renderContent:()=>d.createElement(aE,{maxPassengers:4,passengers:t.passengers,onClose:()=>{o(!1),f()}}),setOpen:o,modalProps:{title:u("mobile_title"),closeOnClickOutside:!0,closeOnCloseButtonClick:!0,onClickOutside:g,minHeight:"auto",stopMouseDownPropagation:!1},dropdownProps:{closeOnClickOutside:!0,onClickOutside:g,position:"end",minWidth:"370px"}},e=>{let{ref:t}=e;return d.createElement(N.I,{wrapperClassName:`${et.Z.passengers} ${(0,v.yl)({xs:300,lg:0})}`,containerRef:t,position:{lg:"middle-horizontal",xl:"middle-horizontal"},"data-ti":"passengers_input",type:"text",label:u("input_label"),value:r?m:"",onMouseDown:p,onFocus:h,readOnly:!0,clearButtonType:"hidden",wrapperProps:eC(s)})})},ax={find_tickets:"Найти билеты",today:"Сегодня",tomorrow:"Завтра",from:"Откуда",to:"Куда",when:"Когда",select_departure_location:"Выберите место отправления",select_arrival_location:"Выберите место прибытия",swapGeoPoints:"Поменять местами отправление и прибытие"},aO={requiredFrom:(0,J.ZP)(ax,"select_departure_location"),requiredTo:(0,J.ZP)(ax,"select_arrival_location")},aw=["from","to"],ak={rzdNumber:"2000000",name:"Москва",type:"trainStation",translitName:"Moskva"},aj={rzdNumber:"2004000",name:"Санкт-Петербург",type:"trainStation",translitName:"Sankt-peterburg"},aC=!1,aN=[ak,aj],aI=[aj,ak],az=new Date,aS=new Date(az.getFullYear(),az.getMonth(),az.getDate()+1),aD=[{name:(0,J.ZP)(ax,"today"),date:eM(az)},{name:(0,J.ZP)(ax,"tomorrow"),date:eM(aS)}],a$=e=>{var t,r,s,l,o,i,u,c,m;let{model:E,inputsTheme:P,hideHints:x,size:O}=e,w=(0,S.H)({min:"md"}),k=(0,y.Ei)(e=>a(3363)(`./${e}/index.json`)),j=(0,n.R)(E),{userway:C}=(0,_.w5)(),{0:I,1:z}=(0,d.useState)({from:!1,to:!1}),$=(0,D.n)({dateFrom:j.searchParams.routes[0].date?eT(j.searchParams.routes[0].date):null,onChangeDates:(0,d.useCallback)(e=>{E.searchParams.routes[0].date=e.dateFrom?eM(e.dateFrom):void 0},[E]),isOneway:!0}),Z={from:j.searchParams.routes[0].from.rzdNumber,to:j.searchParams.routes[0].to.rzdNumber},{validationEnabled:M}=j.state,T=M?j.validationResult.result:null,{0:A,1:F}=(0,d.useState)(null),R=null===(t=null==T?void 0:T.routes)||void 0===t?void 0:t[0],H=null===(s=null===(r=j.salePeriod)||void 0===r?void 0:r.getData())||void 0===s?void 0:s.period,q=(()=>{if(!R)return null;if(A)for(let e=0;e<aw.length;e++){let t=aw[e];if(R[t]&&A===t)return t}for(let e=0;e<aw.length;e++){let t=aw[e];if(R[t])return t}return null})(),L=null===(i=null===(o=null===(l=null==R?void 0:R.from)||void 0===l?void 0:l.errors)||void 0===o?void 0:o[0])||void 0===i?void 0:i.type,V="from"!==q||I.from?void 0:aO[L],B=null===(m=null===(c=null===(u=null==R?void 0:R.to)||void 0===u?void 0:u.errors)||void 0===c?void 0:c[0])||void 0===m?void 0:m.type,G="to"!==q||I.to?void 0:aO[B],W=()=>{E.swapGeoPoints(),null==C||C({title:"search_form_change_destination_click",product:"train"})},Y=()=>{var e;(null===(e=E.validationResult)||void 0===e?void 0:e.isValid)||null==C||C({title:"search_form_error_shown",type:"special",product:"train",validation_errors:eP(j.validationResult)}),E.submit(),F(null),z({from:!1,to:!1});let{from:t,to:a,date:r}=E.searchParams.routes[0],n="trainStation"===t.type?{departure_geo_id:t.rzdNumber}:{},s="trainStation"===a.type?{arrival_geo_id:a.rzdNumber}:{},{searchId:l}=E.submitter;null==C||C(Object.assign(Object.assign(Object.assign(Object.assign(Object.assign({title:"search_form_search_click",product:"train",search_id:l},n),s),ef(r)),{route_type:"oneway",passenger_count:E.searchParams.passengers.list.length}),e_(E.searchParams.passengers)))},U=(e,t)=>{E.searchParams.routes[0][e]=t,null==C||C(Object.assign({title:"search_form_city_hint_click",product:"train",geo_id:t.rzdNumber},ev(e)))},J=e=>{E.searchParams.routes[0].date=e,null==C||C({title:"search_form_date_hint_click	",product:"train",departure_date:eh(e)})};(0,d.useEffect)(()=>{if(E.init(),E.loadSalePeriodData(),!aC){let{from:e,to:t,date:a}=E.searchParams.routes[0],r="trainStation"===e.type?{departure_geo_id:e.rzdNumber}:{},n="trainStation"===t.type?{arrival_geo_id:t.rzdNumber}:{};null==C||C(Object.assign(Object.assign(Object.assign(Object.assign(Object.assign({title:"search_form_first_shown",product:"train"},r),n),ef(a)),{route_type:"oneway",passenger_count:E.searchParams.passengers.list.length}),e_(E.searchParams.passengers))),aC=!0}},[E,C]);let Q=ew(O),X=(0,d.useMemo)(()=>j.searchParams.passengers.list.map(e=>{let{age:t}=e;return{age:t}}),[j.searchParams.passengers.list]);return d.createElement(f.cw,Object.assign({size:Q,layout:{xs:"vertical",xl:"horizontal"}},(0,p.ZP)("train-search-form")),d.createElement("div",{className:et.Z.searchForm},d.createElement("div",{className:`${et.Z.firstSubGroup} ${(0,f.dm)({lg:["bottom"],xl:["none"]})}`},d.createElement("div",{className:et.Z.departure},d.createElement(al,{product:"train",position:{xs:"top",lg:"left"},label:k("from"),fieldName:"from",searchParams:E.searchParams,suggest:E.suggest,hasError:!!(null==R?void 0:R.from),errorMessage:V,onFocus:()=>{M&&F("from")},tabIndex:0,onErrorMessageClose:()=>{z(e=>Object.assign(Object.assign({},e),{from:!0}))},theme:P}),!x&&d.createElement("div",{className:`${(0,g.j)({xs:"none",xl:"inline-flex"})} ${(0,v.E9)(200)} ${(0,v.SG)(100)}`},aN.map(e=>d.createElement(h.zx,Object.assign({color:"secondary-neutral",size:ej(Q),key:e.name,onClick:()=>U("from",e)},(0,p.ZP)("fromHint")),e.name)))),d.createElement(h.zx,Object.assign({"aria-label":k("swapGeoPoints"),className:`${et.Z.switcher} ${(0,g.j)({xs:"inline-flex",lg:"none"})}`,accent:"default",color:"outline-form",leftAddon:d.createElement(b.V,{icon:"arrow-2-up-down_outline"}),onClick:W,tabIndex:0,size:ek(Q)},(0,p.ZP)("swapButton"),eC(P))),d.createElement(h.zx,Object.assign({"aria-label":k("swapGeoPoints"),position:{lg:"middle-horizontal"},className:`${et.Z.switcher} ${(0,g.j)({xs:"none",lg:"inline-flex"})}`,accent:"default",color:"outline-form",leftAddon:d.createElement(b.V,{icon:"arrow-2-left-right_outline"}),onClick:W,tabIndex:0,size:Q},(0,p.ZP)("swapButton"),eC(P))),d.createElement("div",{className:et.Z.arrival},d.createElement(al,{product:"train",position:{xs:"middle-vertical",lg:"right",xl:"middle-horizontal"},label:k("to"),fieldName:"to",searchParams:E.searchParams,suggest:E.suggest,hasError:!!(null==R?void 0:R.to),errorMessage:G,onFocus:()=>{M&&F("to")},tabIndex:0,onErrorMessageClose:()=>{z(e=>Object.assign(Object.assign({},e),{to:!0}))},theme:P}),!x&&d.createElement("div",{className:`${(0,g.j)({xs:"none",xl:"inline-flex"})} ${(0,v.E9)(200)} ${(0,v.SG)(100)}`},aI.map(e=>d.createElement(h.zx,Object.assign({color:"secondary-neutral",size:ej(Q),key:e.name,onClick:()=>U("to",e)},(0,p.ZP)("fromHint")),e.name))))),d.createElement(D.S,Object.assign({},$,{withAnimation:!1,highlightFutureDates:!0,highlightPastDates:!0,showPastDatesMobile:!0,salePeriod:H,disabledPastDays:!1,product:"train",block:"search_form",apiHost:j.calendarApiHost,calendarHost:j.holidaysApiHost,isDesktop:null==w||w,cityIds:Z,popupContentClassName:et.Z.calendarPopup,travelers:X,target:e=>{var t,a,r;let{fromRef:n}=e;return d.createElement("div",{className:`${et.Z.secondSubGroup}`},d.createElement("div",{className:`${et.Z.targetDate}`},d.createElement("div",{ref:n},d.createElement(N.I,{wrapperClassName:`${et.Z.date} ${(0,f.dm)({xs:["bottom"],lg:["none"]})}`,wrapperProps:eC(P),position:{xs:"bottom",lg:"left",xl:"middle-horizontal"},"data-ti":"trip-dates",type:"text",label:k("when"),value:e$({dateFrom:null===(t=$.chosenDates)||void 0===t?void 0:t.dateFrom,dateTo:null===(a=$.chosenDates)||void 0===a?void 0:a.dateTo}),onChange:()=>{},onClear:()=>{$.clearDate()},tabIndex:0,readOnly:!0,clearButtonType:{xs:"hidden",lg:"from"===$.chosenDates.focusedInput&&(null===(r=$.chosenDates)||void 0===r?void 0:r.dateFrom)?"force":"hidden"}})),!x&&d.createElement("div",{className:`${(0,g.j)({xs:"none",xl:"inline-flex"})} ${(0,v.E9)(200)} ${(0,v.SG)(100)}`},aD.map(e=>d.createElement(h.zx,Object.assign({color:"secondary-neutral",size:ej(Q),key:e.name,onClick:()=>J(e.date)},(0,p.ZP)("dateHint")),e.name)))),d.createElement(aP,{searchParams:E.searchParams,initiated:j.state.initiated,theme:P}),d.createElement("div",{className:et.Z.submitButton},d.createElement(h.zx,Object.assign({isLoading:j.submitted,position:{lg:"right"},fullWidth:!0,color:"primary",type:"button","data-ti":"submit-button",onClick:Y},eC(P)),k("find_tickets"))))}}))))},aZ=e=>{let{model:t,inputsTheme:a,size:r,hideHints:n=!1,passengersBlockEnabled:s=!1}=e;return s?d.createElement(a$,{model:t,inputsTheme:a,size:r,hideHints:n}):d.createElement(av,{model:t,inputsTheme:a,size:r,hideHints:n})};function aM(e){let{searchParams:t,trainSuggestHost:a,mainDomain:n,calendarApiHost:l,holidaysApiHost:o,salePeriodHost:i,lastSearch:u,trainSubmitter:c,suggestLoader:d,salePeriodLoader:m,relevantSuggestLoader:p,renderEmptyFieldsOnSsr:h,logError:g,onSubmit:f}=e,b=null!=u?u:new t7,v=(0,s.n)(n);return(0,r.sj)(new ae({searchParams:t,salePeriod:new at(null!=m?m:new s.S(null!=i?i:v)),suggest:new aa(null!=d?d:new s.T(null!=a?a:v),null!=p?p:new s.c(null!=a?a:v),g),validator:new an,lastSearch:b,searchParamsInitializer:new t1,submitter:c||new t8({mainDomain:n,onSubmit:f}),calendarApiHost:null!=l?l:(0,s.g)(v),holidaysApiHost:void 0===o?(0,s.a)(v):o,renderEmptyFieldsOnSsr:h}))}class aT{getInitialSearchParams(e){let t=aA();if(e){let a=this.convertOuterSearchParams(e);return Object.assign(Object.assign({},t),a)}return t}convertOuterSearchParams(e){let t=null==e?void 0:e.routes[0];return Object.assign({routes:[{from:t.from?{type:"etrainStation",name:t.from.value,stationId:t.from.id}:{type:"unknown",name:""},to:t.to?{type:"etrainStation",name:t.to.value,stationId:t.to.id}:{type:"unknown",name:""},date:null==t?void 0:t.date}]},(null==e?void 0:e.searchId)?{searchId:e.searchId}:{})}}function aA(){return{routes:[{from:{type:"unknown",name:""},to:{type:"unknown",name:""},date:void 0}]}}function aF(e){return!!e&&void 0!==e.stationId}function aR(e){return!!e&&"object"==typeof e&&!!("stationId"in e&&"name"in e&&eu(e.stationId)&&eu(e.name))}let aH=(e,t)=>{let{date:a}=e,r=aR(e.from)?e.from:t.from,n=aR(e.to)?e.to:t.to,s=aF(r)?`feid::${r.stationId};`:"",l=aF(n)?`teid::${n.stationId};`:"",o=eu(r.name)?`f::${r.name};`:"",i=eu(n.name)?`t::${n.name};`:"",u=ei(a)?`d::${a};`:"";return`${o}${s}${i}${l}${u}`},aq=(e,t)=>{let{routes:a}=e;return aH(a[0],t.routes[0])},aL=(e,t)=>{let a=null==e?void 0:e.split(";"),r={f:"",feid:"",t:"",teid:"",d:void 0};null==a||a.forEach(e=>{let[t,a]=e.split("::");t&&a&&(r[t]=a)});let n={type:"etrainStation",name:r.f,stationId:r.feid},s={type:"etrainStation",name:r.t,stationId:r.teid};return{routes:[{from:aR(n)?n:t.routes[0].from,to:aR(s)?s:t.routes[0].to,date:ec(r.d)}]}};class aV extends en{constructor(){super(...arguments),this.initialSearchParams=aA(),this.trainCookieName="sf_etrain"}searchParamsToCookieValue(e){return aq(e,this.initialSearchParams)}cookieValueToSearchParams(e){return aL(e,this.initialSearchParams)}get cookieName(){return this.trainCookieName}}class aB{constructor(e){this.params=e}gotoOffers(e){this.etrainSearchId=(0,o.Z)();let[t]=e.routes;this.openPage((0,i.t3)(Object.assign(Object.assign({mainDomain:this.params.mainDomain.replace("https://","").replace("http://","")},(null==t?void 0:t.date)?{searchId:this.searchId}:{}),this.getExternalSearchParams(e))))}openPage(e){location.href=e}getExternalSearchParams(e){return{trips:e.routes.map(e=>({date:e.date,from:{id:e.from.stationId,value:e.from.name},to:"route"===this.params.mode?{id:e.to.stationId,value:e.to.name}:void 0}))}}get searchId(){return this.etrainSearchId}}class aG{get fetch(){return function(){return fetch(...arguments)}}constructor(e){this.etrainApiHost=(0,s.n)(e)}getSuggestItems(e){return(0,u.mG)(this,arguments,void 0,function(e){var t=this;let{request:{value:a},abortController:r}=e;return function*(){let e=new URLSearchParams({name:a});return function(e){if(Array.isArray(e))return e.map(e=>({type:"geoPoint",geoPoint:{name:e.label,type:"etrainStation",stationId:e.value}}));throw Error(`Unknown response format (type '${typeof e}')`)}((yield t.fetch(`${t.etrainApiHost}/station/suggest.php?${e}`,{method:"GET",redirect:"follow",signal:r.signal}).then(e=>e.json())))}()})}}class aW extends ed{constructor(e){var{suggest:t,calendarApiHost:a}=e;super((0,u._T)(e,["suggest","calendarApiHost"])),this.suggest=t}}class aY extends ep{constructor(e,t){super(t),this.loader=e}getSuggestItems(e){return(0,u.mG)(this,void 0,void 0,function*(){return""===e.request.value?this.loader.getSuggestItems(Object.assign(Object.assign({},e),{request:Object.assign(Object.assign({},e.request),{value:"Москва"})})):this.loader.getSuggestItems(e)})}}let aU=(0,c.S1)().rules({routes:(0,c.pb)((0,c.S1)().rules({from:{requiredFrom:e=>!e||"unknown"===e.type},to:{requiredTo:e=>!e||"unknown"===e.type}}))}),aJ=(0,c.S1)().rules({routes:(0,c.pb)((0,c.S1)().rules({from:{requiredFrom:e=>!e||"unknown"===e.type}}))});class aQ{constructor(e){this.mode=e}validate(e){switch(this.mode){case"route":{let t=aU.validate(e);return{result:t,isValid:null===t}}case"station":{let t=aJ.validate(e);return{result:t,isValid:null===t}}default:return{result:null,isValid:!1}}}}let aX=(0,d.memo)(e=>{let{fieldName:t,suggest:r}=e,s=(0,y.Ei)(e=>a(91285)(`./${e}/index.json`)),{items:l,isError:o}=(0,n.R)(r).getItems({fieldName:t});return o&&0===l.length?d.createElement(U.vQ,null,s("error")):l.map(e=>d.createElement(U.uj,{value:e.geoPoint.stationId,key:e.geoPoint.stationId},d.createElement(F.bL,{addonSize:"none"},d.createElement(R.cM,Object.assign({label:e.geoPoint.name,isLabelAccent:!0,emphasized:!0},(0,p.ZP)("suggest-item-name"))))))});function aK(e){let{fieldName:t,searchParams:a,suggest:r,routeIndex:s=0}=e,l=(0,u._T)(e,["fieldName","searchParams","suggest","routeIndex"]),{items:o,isDefaultItems:i}=(0,n.R)(r).getItems({fieldName:t}),c=(0,n.R)(a,{sync:!0}).routes[s],m=c["from"===t?"to":"from"],p=o.map((e,t)=>({value:e.geoPoint.stationId,hiddenValue:Object.assign(Object.assign({},e),{index:t})})),h=(0,d.useCallback)(e=>{r.loadItems({value:e,fieldName:t,relatedField:m,routeIndex:s})},[t,m,s,r]);return d.createElement(eJ,Object.assign({},l,{fieldName:t,point:c[t],setPoint:e=>{a.routes[s][t]=e},isDefaultItems:i,items:p,loadItems:h,renderContent:()=>d.createElement(aX,{fieldName:t,suggest:r}),searchId:null==a?void 0:a.searchId}))}let a0={show_schedule:"Показать расписание",today:"Сегодня",tomorrow:"Завтра",from:"Откуда",to:"Куда",when:"Когда",select_departure_location:"Выберите станцию отправления",select_arrival_location:"Выберите станцию прибытия",swap_geo_points:"Поменять местами отправление и прибытие",station_name:"Название станции"},a1={requiredFrom:(0,J.ZP)(a0,"select_departure_location"),requiredTo:(0,J.ZP)(a0,"select_arrival_location")},a2=["from","to"],a9={stationId:"20000",name:"Москва",type:"etrainStation"},a5={stationId:"46707",name:"Мытищи",type:"etrainStation"},a3=!1,a6=[a9,a5],a4=[a5,a9],a7=new Date,a8=new Date(a7.getFullYear(),a7.getMonth(),a7.getDate()+1),re=[{name:(0,J.ZP)(a0,"today"),date:eM(a7)},{name:(0,J.ZP)(a0,"tomorrow"),date:eM(a8)}],rt=e=>{var t,r,s,l,o,i,u;let{model:c,inputsTheme:E,size:P}=e,x=(0,S.H)({min:"md"}),O=(0,y.Ei)(e=>a(64714)(`./${e}/index.json`)),w=(0,n.R)(c),{userway:k}=(0,_.w5)(),{0:j,1:C}=(0,d.useState)({from:!1,to:!1}),I=(0,D.n)({dateFrom:w.searchParams.routes[0].date?eT(w.searchParams.routes[0].date):null,onChangeDates:(0,d.useCallback)(e=>{c.searchParams.routes[0].date=e.dateFrom?eM(e.dateFrom):void 0},[c]),isOneway:!0,autoClose:!0}),{validationEnabled:z}=w.state,$=z?w.validationResult.result:null,{0:Z,1:M}=(0,d.useState)(null),T=null===(t=null==$?void 0:$.routes)||void 0===t?void 0:t[0],A=(()=>{if(!T)return null;if(Z)for(let e=0;e<a2.length;e++){let t=a2[e];if(T[t]&&Z===t)return t}for(let e=0;e<a2.length;e++){let t=a2[e];if(T[t])return t}return null})(),F=null===(l=null===(s=null===(r=null==T?void 0:T.from)||void 0===r?void 0:r.errors)||void 0===s?void 0:s[0])||void 0===l?void 0:l.type,R="from"!==A||j.from?void 0:a1[F],H=null===(u=null===(i=null===(o=null==T?void 0:T.to)||void 0===o?void 0:o.errors)||void 0===i?void 0:i[0])||void 0===u?void 0:u.type,q="to"!==A||j.to?void 0:a1[H],L=()=>{c.swapGeoPoints(),null==k||k({title:"search_form_change_destination_click",product:"etrain"})},V=()=>{var e;(null===(e=c.validationResult)||void 0===e?void 0:e.isValid)||null==k||k({title:"search_form_error_shown",type:"special",product:"etrain",validation_errors:eP(w.validationResult)}),c.submit(),M(null),C({from:!1,to:!1});let{from:t,to:a,date:r}=c.searchParams.routes[0],n="etrainStation"===t.type?{departure_geo_id:t.stationId}:{},s="etrainStation"===a.type?{arrival_geo_id:a.stationId}:{},{searchId:l}=c.submitter;null==k||k(Object.assign(Object.assign(Object.assign(Object.assign({title:"search_form_search_click",product:"etrain",search_id:l},n),s),ef(r)),{route_type:"oneway"}))},B=(e,t)=>{c.searchParams.routes[0][e]=t,null==k||k(Object.assign({title:"search_form_city_hint_click",product:"etrain",geo_id:t.stationId},ev(e)))},G=e=>{c.searchParams.routes[0].date=e,null==k||k({title:"search_form_date_hint_click	",product:"etrain",departure_date:eh(e)})};(0,d.useEffect)(()=>{if(c.init(),!a3){let{from:e,to:t,date:a}=c.searchParams.routes[0],r="etrainStation"===e.type?{departure_geo_id:e.stationId}:{},n="etrainStation"===t.type?{arrival_geo_id:t.stationId}:{};null==k||k(Object.assign(Object.assign(Object.assign(Object.assign({title:"search_form_first_shown",product:"etrain"},r),n),ef(a)),{route_type:"oneway"})),a3=!0}},[c,k]);let W=ew(P);return d.createElement(f.cw,Object.assign({size:W,layout:{xs:"vertical",xl:"horizontal"}},(0,p.ZP)("etrain-search-form")),d.createElement("div",{className:ea.Z.searchForm},d.createElement(D.S,Object.assign({},I,{withAnimation:!1,highlightFutureDates:!0,highlightPastDates:!0,showPastDatesMobile:!0,disabledPastDays:!1,product:"etrain",block:"search_form",isDesktop:null==x||x,hidePriceBlock:!0,calendarHost:null,popupContentClassName:ea.Z.calendarPopup,target:e=>{var t,a,r;let{fromRef:n}=e;return d.createElement("div",{className:ea.Z.firstSubGroup},d.createElement("div",{className:ea.Z.departure},d.createElement(aK,{product:"etrain",position:{xs:"top",lg:"left"},label:O("from"),fieldName:"from",searchParams:c.searchParams,suggest:c.suggest,hasError:!!(null==T?void 0:T.from),errorMessage:R,onFocus:()=>{z&&M("from")},tabIndex:0,onErrorMessageClose:()=>{C(e=>Object.assign(Object.assign({},e),{from:!0}))},theme:E}),d.createElement("div",{className:(0,m.Z)((0,g.j)({xs:"none",xl:"inline-flex"}),(0,v.E9)(200),(0,v.SG)(100))},a6.map(e=>d.createElement(h.zx,{color:"secondary-neutral",size:ej(W),key:e.name,onClick:()=>B("from",e)},e.name)))),d.createElement(h.zx,Object.assign({"aria-label":O("swap_geo_points"),className:`${ea.Z.switcher} ${(0,g.j)({xs:"inline-flex",lg:"none"})}`,accent:"default",color:"outline-form",leftAddon:d.createElement(b.V,{icon:"arrow-2-up-down_outline"}),size:ek(W),onClick:L,tabIndex:0},(0,p.ZP)("swapButton"),eC(E))),d.createElement(h.zx,Object.assign({"aria-label":O("swap_geo_points"),position:{lg:"middle-horizontal"},className:`${ea.Z.switcher} ${(0,g.j)({xs:"none",lg:"inline-flex"})}`,accent:"default",color:"outline-form",leftAddon:d.createElement(b.V,{icon:"arrow-2-left-right_outline"}),size:W,onClick:L,tabIndex:0},(0,p.ZP)("swapButton"),eC(E))),d.createElement("div",{className:ea.Z.arrival},d.createElement(aK,{product:"etrain",position:{xs:"middle-vertical",lg:"right",xl:"middle-horizontal"},label:O("to"),fieldName:"to",searchParams:c.searchParams,suggest:c.suggest,hasError:!!(null==T?void 0:T.to),errorMessage:q,onFocus:()=>{z&&M("to")},tabIndex:0,onErrorMessageClose:()=>{C(e=>Object.assign(Object.assign({},e),{to:!0}))},theme:E}),d.createElement("div",{className:(0,m.Z)((0,g.j)({xs:"none",xl:"inline-flex"}),(0,v.E9)(200),(0,v.SG)(100))},a4.map(e=>d.createElement(h.zx,{color:"secondary-neutral",size:ej(W),key:e.name,onClick:()=>B("to",e)},e.name)))),d.createElement("div",{className:(0,m.Z)(ea.Z.targetDate,(0,g.j)({lg:"flex",xl:"block"}),(0,f.dm)({lg:["top"],xl:["none"]}))},d.createElement("div",{ref:n,className:ea.Z.dateWrapper},d.createElement(N.I,{wrapperClassName:`${ea.Z.date} ${(0,v.yl)({xs:300,lg:0})}`,wrapperProps:eC(E),position:{xs:"bottom",lg:"left",xl:"middle-horizontal"},"data-ti":"trip-dates",type:"text",label:O("when"),value:e$({dateFrom:null===(t=I.chosenDates)||void 0===t?void 0:t.dateFrom,dateTo:null===(a=I.chosenDates)||void 0===a?void 0:a.dateTo}),onChange:()=>{},onClear:()=>{I.clearDate()},tabIndex:0,readOnly:!0,clearButtonType:{xs:"hidden",lg:"from"===I.chosenDates.focusedInput&&(null===(r=I.chosenDates)||void 0===r?void 0:r.dateFrom)?"force":"hidden"}})),d.createElement("div",{className:`${(0,g.j)({xs:"none",xl:"inline-flex"})} ${(0,v.E9)(200)} ${(0,v.SG)(100)}`},re.map(e=>d.createElement(h.zx,{color:"secondary-neutral",size:ej(W),key:e.name,onClick:()=>G(e.date)},e.name))),d.createElement("div",{className:(0,m.Z)(ea.Z.submitButton,(0,g.j)({xs:"none",lg:"block",xl:"none"}))},d.createElement(h.zx,Object.assign({className:`${(0,f.dm)({xs:["top"],lg:["none"]})}`,isLoading:w.submitted,position:{lg:"right"},fullWidth:!0,type:"button","data-ti":"submit-button",onClick:V},eC(E)),O("show_schedule")))),d.createElement("div",{className:(0,m.Z)(ea.Z.submitButton,(0,g.j)({lg:"none",xl:"block"}))},d.createElement(h.zx,Object.assign({isLoading:w.submitted,position:{lg:"right"},fullWidth:!0,type:"button","data-ti":"submit-button",onClick:V},eC(E)),O("show_schedule"))))}}))))},ra={requiredFrom:(0,J.ZP)(a0,"select_departure_location"),requiredTo:(0,J.ZP)(a0,"select_arrival_location")},rr=!1,rn={stationId:"20000",name:"Москва",type:"etrainStation",translitName:"Moskva"},rs=new Date,rl=new Date(rs.getFullYear(),rs.getMonth(),rs.getDate()+1),ro=[{name:(0,J.ZP)(a0,"today"),date:eM(rs)},{name:(0,J.ZP)(a0,"tomorrow"),date:eM(rl)}],ri=["from"],ru=e=>{var t,r,s,l;let{model:o,inputsTheme:i,size:u}=e,c=(0,S.H)({min:"md"}),b=(0,y.Ei)(e=>a(64714)(`./${e}/index.json`)),E=(0,n.R)(o),{userway:P}=(0,_.w5)(),{0:x,1:O}=(0,d.useState)({from:!1,to:!1}),w=(0,D.n)({dateFrom:E.searchParams.routes[0].date?eT(E.searchParams.routes[0].date):null,onChangeDates:(0,d.useCallback)(e=>{o.searchParams.routes[0].date=e.dateFrom?eM(e.dateFrom):void 0},[o]),isOneway:!0,autoClose:!0}),{validationEnabled:k}=E.state,j=k?E.validationResult.result:null,{0:C,1:I}=(0,d.useState)(null),z=null===(t=null==j?void 0:j.routes)||void 0===t?void 0:t[0],$=(()=>{if(!z)return null;if(C)for(let e=0;e<ri.length;e++){let t=ri[e];if(z[t]&&C===t)return t}for(let e=0;e<ri.length;e++){let t=ri[e];if(z[t])return t}return null})(),Z=null===(l=null===(s=null===(r=null==z?void 0:z.from)||void 0===r?void 0:r.errors)||void 0===s?void 0:s[0])||void 0===l?void 0:l.type,M="from"!==$||x.from?void 0:ra[Z],T=()=>{var e;(null===(e=o.validationResult)||void 0===e?void 0:e.isValid)||null==P||P({title:"search_form_error_shown",type:"special",product:"etrain",validation_errors:eP(E.validationResult)}),o.submit(),I(null),O({from:!1,to:!1});let{from:t,date:a}=o.searchParams.routes[0],r="etrainStation"===t.type?{departure_geo_id:t.stationId}:{},{searchId:n}=o.submitter;null==P||P(Object.assign(Object.assign(Object.assign({title:"search_form_search_click",product:"etrain",search_id:n},r),ef(a)),{route_type:"oneway"}))},A=(e,t)=>{o.searchParams.routes[0][e]=t,null==P||P(Object.assign({title:"search_form_city_hint_click",product:"etrain",geo_id:t.stationId},ev(e)))},F=e=>{o.searchParams.routes[0].date=e,null==P||P({title:"search_form_date_hint_click",product:"etrain",departure_date:eh(e)})};(0,d.useEffect)(()=>{if(o.init(),!rr){let{from:e,to:t,date:a}=o.searchParams.routes[0],r="etrainStation"===e.type?{departure_geo_id:e.stationId}:{},n="etrainStation"===t.type?{arrival_geo_id:t.stationId}:{};null==P||P(Object.assign(Object.assign(Object.assign(Object.assign({title:"search_form_first_shown",product:"etrain"},r),n),ef(a)),{route_type:"oneway"})),rr=!0}},[o,P]);let R=ew(u);return d.createElement(f.cw,Object.assign({size:R,layout:{xs:"vertical",xl:"horizontal"}},(0,p.ZP)("etrain-search-form")),d.createElement("div",{className:er.Z.searchForm},d.createElement(D.S,Object.assign({},w,{withAnimation:!1,highlightFutureDates:!0,highlightPastDates:!0,showPastDatesMobile:!0,disabledPastDays:!1,product:"etrain",block:"search_form",isDesktop:null==c||c,calendarHost:null,hidePriceBlock:!0,popupContentClassName:er.Z.calendarPopup,target:e=>{var t,a,r;let{fromRef:n}=e;return d.createElement("div",{className:er.Z.firstSubGroup},d.createElement("div",{className:er.Z.departure},d.createElement(aK,{product:"etrain",position:{xs:"top",md:"left"},label:b("station_name"),fieldName:"from",searchParams:o.searchParams,suggest:o.suggest,hasError:!!(null==z?void 0:z.from),errorMessage:M,onFocus:()=>{k&&I("from")},tabIndex:0,onErrorMessageClose:()=>{O(e=>Object.assign(Object.assign({},e),{from:!0}))},theme:i}),d.createElement("div",{className:(0,m.Z)((0,g.j)({xs:"none",xl:"inline-flex"}),(0,v.E9)(200),(0,v.SG)(100))},d.createElement(h.zx,{color:"secondary-neutral",size:ej(R),key:rn.name,onClick:()=>A("from",rn)},rn.name))),d.createElement("div",{className:(0,m.Z)(er.Z.targetDate,(0,g.j)({lg:"flex",xl:"block"}))},d.createElement("div",{ref:n,className:er.Z.dateWrapper},d.createElement(N.I,{wrapperClassName:`${er.Z.date} ${(0,f.dm)({xs:["bottom"],lg:["none"]})}`,wrapperProps:eC(i),position:{xs:"bottom",md:"middle-horizontal"},"data-ti":"trip-dates",type:"text",label:b("when"),value:e$({dateFrom:null===(t=w.chosenDates)||void 0===t?void 0:t.dateFrom,dateTo:null===(a=w.chosenDates)||void 0===a?void 0:a.dateTo}),onChange:()=>{},onClear:()=>{w.clearDate()},tabIndex:0,readOnly:!0,clearButtonType:{xs:"hidden",lg:"from"===w.chosenDates.focusedInput&&(null===(r=w.chosenDates)||void 0===r?void 0:r.dateFrom)?"force":"hidden"}})),d.createElement("div",{className:`${(0,g.j)({xs:"none",xl:"inline-flex"})} ${(0,v.E9)(200)} ${(0,v.SG)(100)}`},ro.map(e=>d.createElement(h.zx,{color:"secondary-neutral",size:ej(R),key:e.name,onClick:()=>F(e.date)},e.name))),d.createElement("div",{className:(0,m.Z)(er.Z.submitButton,(0,g.j)({xs:"none",lg:"block",xl:"none"}))},d.createElement(h.zx,Object.assign({className:`${(0,f.dm)({xs:["top"],lg:["none"]})}`,isLoading:E.submitted,position:{lg:"right"},fullWidth:!0,type:"button","data-ti":"submit-button",onClick:T},eC(i)),b("show_schedule")))),d.createElement("div",{className:(0,m.Z)(er.Z.submitButton,(0,g.j)({lg:"none",xl:"block"}))},d.createElement(h.zx,Object.assign({isLoading:E.submitted,position:{md:"right"},fullWidth:!0,type:"button","data-ti":"submit-button",onClick:T},eC(i)),b("show_schedule"))))}}))))};function rc(e){let{mode:t,searchParams:a,etrainSuggestHost:n,mainDomain:l,lastSearch:o,ETrainSubmitter:i,suggestLoader:u,renderEmptyFieldsOnSsr:c,logError:d}=e,m=null!=o?o:new aV,p=(0,s.n)(l);return(0,r.sj)(new aW({searchParams:a,suggest:new aY(null!=u?u:new aG(null!=n?n:p),d),validator:new aQ(t),lastSearch:m,searchParamsInitializer:new aT,submitter:i||new aB({mainDomain:l,mode:t}),renderEmptyFieldsOnSsr:c}))}let rd={multi:"Все",avia:"Авиабилеты",train:"Ж/д билеты",bus:"Автобусы",etrain:"Электрички",hotel:"Отели",tours:"Туры",go:"Приключения",aeroexpress:"Аэроэкспрессы"};(0,J.ZP)(rd,"hotel"),(0,J.ZP)(rd,"avia"),(0,J.ZP)(rd,"train"),(0,J.ZP)(rd,"bus"),(0,J.ZP)(rd,"etrain"),(0,J.ZP)(rd,"go"),(0,J.ZP)(rd,"tours"),(0,J.ZP)(rd,"aeroexpress")}}]);